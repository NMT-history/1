<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blitz Dates - Онлайн Вікторина</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&family=Inter:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #121212;
            --surface-color: #1E1E1E;
            --surface-light-color: #2a2a2a;
            --text-color: #E0E0E0;
            --text-secondary-color: #B0B0B0;
            --accent-neon-blue: #00AEEF;
            --accent-lime-green: #AFFF33;
            --correct-color: #4CAF50;
            --incorrect-color: #F44336;
            --selected-color: #FFC107;
            --border-radius: 8px;
            --transition-speed: 0.3s;
        }

        body {
            font-family: 'Roboto', 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            box-sizing: border-box;
            overflow-x: hidden;
        }

        .app-container {
            width: 100%;
            max-width: 950px; /* Slightly wider for player panels */
            margin: auto;
        }

        .screen {
            background-color: var(--surface-color);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: 0px 4px 12px rgba(0, 0, 0, 0.4);
            margin-bottom: 20px;
            text-align: center;
            display: none; /* Hidden by default */
            animation: fadeIn var(--transition-speed) ease-out;
        }
        .screen.active { display: block; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(0, 174, 239, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(0, 174, 239, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 174, 239, 0); }
        }

        h1, h2, h3 { color: #FFFFFF; margin-top: 0; }
        h1 { font-size: 2.2em; margin-bottom: 25px; letter-spacing: 1px;}
        h2 { font-size: 1.7em; margin-bottom: 20px; }
        h3 { font-size: 1.4em; margin-bottom: 15px; }

        label { display: block; margin-top: 15px; margin-bottom: 5px; font-weight: bold; color: var(--text-secondary-color); text-align: left; }
        input[type="text"], input[type="password"], input[type="number"], select {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border-radius: 6px;
            border: 1px solid #333333;
            background-color: #2C2C2C;
            color: var(--text-color);
            font-size: 1em;
            box-sizing: border-box;
        }
        input[type="text"]::placeholder, input[type="password"]::placeholder { color: #666; }

        button {
            background-color: var(--accent-neon-blue);
            color: var(--bg-color);
            border: none;
            padding: 12px 25px;
            margin: 10px 5px;
            border-radius: 6px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: background-color var(--transition-speed), transform 0.1s, box-shadow var(--transition-speed);
            box-shadow: 0px 2px 4px rgba(0,0,0,0.2);
            min-width: 120px;
        }
        button:hover { background-color: var(--accent-lime-green); color:var(--bg-color); box-shadow: 0px 0px 15px var(--accent-lime-green); }
        button:active { transform: scale(0.97); }
        button:disabled { background-color: #555; color: #888; cursor: not-allowed; box-shadow: none; }
        button.pulsating { animation: pulse 2s infinite; }

        /* Header Profile */
        .header-profile {
            position: fixed;
            top: 15px;
            right: 15px;
            z-index: 1001;
        }
        .profile-nickname-btn {
            background-color: var(--surface-light-color);
            color: var(--accent-neon-blue);
            padding: 8px 15px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: bold;
            border: 1px solid var(--accent-neon-blue);
        }
        .profile-dropdown {
            display: none;
            position: absolute;
            top: 45px;
            right: 0;
            background-color: var(--surface-color);
            border: 1px solid #444;
            border-radius: var(--border-radius);
            padding: 15px;
            width: 280px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            text-align: left;
        }
        .profile-dropdown.active { display: block; }
        .profile-dropdown h4 { margin-top: 0; color: var(--accent-lime-green); }
        .profile-dropdown p { font-size: 0.9em; margin: 5px 0; }
        .profile-dropdown strong { color: var(--text-color); }
        .profile-dropdown ul { list-style: none; padding: 0; margin: 10px 0; max-height: 150px; overflow-y: auto; }
        .profile-dropdown ul li { font-size: 0.85em; padding: 3px; border-bottom: 1px dashed #333; }
        .profile-dropdown ul li:last-child { border-bottom: none; }

        /* Lobby Screen */
        .lobby-options button { display: block; width: 80%; margin: 15px auto; padding: 15px; font-size: 1.1em;}
        
        /* Create/Join Room Forms */
        .form-section { border: 1px solid #444; padding: 15px; margin-top: 20px; border-radius: var(--border-radius); }
        #roomListContainer { max-height: 200px; overflow-y: auto; border: 1px solid #444; padding: 5px; margin-top:10px; }
        .room-list-item { display: flex; justify-content: space-between; align-items:center; padding: 8px 10px; border-bottom: 1px solid #333; cursor: pointer; transition: background-color var(--transition-speed);}
        .room-list-item:hover { background-color: var(--surface-light-color); }
        .room-list-item.selected-room { background-color: var(--accent-neon-blue); color: var(--bg-color); }
        .room-list-item span { margin-left: 10px; font-size: 0.9em; color: var(--text-secondary-color); }
        .room-list-item .room-name { flex-grow: 1; text-align: left;}


        /* Waiting Screen */
        #waitingScreen .countdown { font-size: 3em; font-weight: bold; margin: 20px 0; color: var(--accent-lime-green); }
        #waitingPlayersList li { list-style: none; padding: 5px; font-size: 1.1em; }

        /* Match Screen */
        .match-top-bar { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px; flex-wrap: wrap; gap: 10px;}
        .player-info { background-color: var(--surface-light-color); padding: 10px 15px; border-radius: var(--border-radius); width: calc(50% - 10px); box-sizing: border-box; margin-bottom: 10px; text-align:left; }
        .player-info h3 { font-size: 1.2em; margin-bottom: 8px; color: var(--accent-neon-blue); display:flex; justify-content: space-between; align-items:center; }
        .player-level { font-size: 0.8em; color: var(--accent-lime-green); padding: 2px 6px; border: 1px solid var(--accent-lime-green); border-radius: 4px; }
        .lives-container { display: flex; margin-top: 5px; }
        .life-heart { font-size: 1.6em; color: var(--incorrect-color); margin-right: 4px; transition: opacity var(--transition-speed), transform var(--transition-speed); }
        .life-heart.lost { opacity: 0.2; transform: scale(0.8); }

        .question-progress { text-align: center; font-size: 1.2em; margin-bottom: 15px; color: var(--text-secondary-color); }
        .question-text-display { font-size: 1.5em; margin-bottom: 20px; padding: 20px; background-color: #222; border-radius: 6px; min-height: 80px; display: flex; align-items: center; justify-content: center; line-height: 1.4; }
        .options-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 12px; margin-bottom: 20px; }
        .option-button { padding: 18px; font-size: 1.05em; text-align: left; width: 100%; box-sizing: border-box; border: 1px solid #444 }
        .option-button.selected { background-color: var(--selected-color) !important; color: var(--bg-color) !important; font-weight: bold; border-color: var(--selected-color) !important;}
        .option-button.correct { background-color: var(--correct-color) !important; color: white !important; border-color: var(--correct-color) !important;}
        .option-button.wrong { background-color: var(--incorrect-color) !important; color: white !important; border-color: var(--incorrect-color) !important; opacity: 1 !important;}
        .option-button.disabled-after-reveal:not(.correct):not(.selected) { opacity: 0.5; pointer-events: none; }


        .timer-container { margin-bottom: 15px; }
        .timer-bar-outer { width: 100%; height: 12px; background-color: #333; border-radius: 6px; overflow: hidden; }
        .timer-bar-inner { height: 100%; width: 100%; background-color: var(--accent-lime-green); /* transition будет управляться JS для сброса */ }
        .timer-text { font-size: 1.2em; margin-top: 5px; color: var(--text-secondary-color); }
        .brief-info-display { margin-top: 15px; padding: 10px; background-color: #222; border-radius: var(--border-radius); font-style: italic; color: var(--text-secondary-color); font-size: 0.95em;}

        .match-bottom-bar { margin-top: 20px; border-top: 1px solid #333; padding-top: 15px; display:flex; justify-content:space-between; align-items:center; }
        #matchTimerDisplay { font-weight: bold; font-size: 1.1em; }

        /* Result Modal */
        #resultModal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.85); display: none; justify-content: center; align-items: center; z-index: 1000; animation: fadeIn var(--transition-speed) ease-out; }
        .modal-content { background-color: var(--surface-color); padding: 30px; border-radius: var(--border-radius); box-shadow: 0 5px 15px rgba(0,0,0,0.5); width: 90%; max-width: 700px; text-align: center; max-height: 90vh; overflow-y: auto;}
        #resultModal table { width: 100%; margin-top: 20px; border-collapse: collapse; }
        #resultModal th, #resultModal td { border: 1px solid #444; padding: 10px; text-align: left; }
        #resultModal th { background-color: #2C2C2C; }
        .modal-buttons { margin-top: 25px; }
        #mistakesList { list-style: none; padding: 0; text-align: left; font-size: 0.9em; max-height: 150px; overflow-y: auto; background-color: #222; padding:10px; border-radius: var(--border-radius); margin-top: 10px;}
        #mistakesList li { padding: 5px 0; border-bottom: 1px dashed #444; }
        #mistakesList li:last-child { border-bottom: none; }
        #mistakesList strong { color: var(--accent-lime-green); }
        #mistakesList .user-answer { color: var(--incorrect-color); }
        #mistakesList .correct-answer-info { color: var(--correct-color); }


        #statusMessage { padding: 10px; margin-bottom: 15px; border-radius: var(--border-radius); font-weight: bold; display:none; }
        #statusMessage.success { background-color: var(--correct-color); color: white; }
        #statusMessage.error { background-color: var(--incorrect-color); color: white; }
        #statusMessage.info { background-color: var(--accent-neon-blue); color: var(--bg-color); }

        /* Placeholders */
        #soloGameSettingsScreen .form-section, #createRoomForm .form-section, #joinRoomScreen .form-section { margin-top: 0; }
        #chatContainer { display: none; }

        @media (max-width: 768px) {
            .player-info { width: 100%; }
            .options-grid { grid-template-columns: 1fr; } /* Single column on smaller screens */
        }
    </style>
</head>
<body>
    <div class="header-profile">
        <button class="profile-nickname-btn" id="profileBtn">Профіль</button>
        <div class="profile-dropdown" id="profileDropdown">
            <h4>Профіль: <span id="profileDisplayNickname">Гість</span></h4>
            <p>Рівень: <strong id="profileLevel">1 (Новачок)</strong></p>
            <p>Загальний рахунок: <strong id="profileTotalScore">0</strong></p>
            <p>Зіграно раундів: <strong id="profileRoundsPlayed">0</strong></p>
            <p>Перемог: <strong id="profileWins">0</strong></p>
            <p>Середня точність: <strong id="profileAvgAccuracy">0</strong>%</p>
            <h5>Історія останніх матчів:</h5>
            <ul id="profileMatchHistory"><li>Немає даних</li></ul>
            <button id="logoutBtn">Вийти (змінити нік)</button>
        </div>
    </div>

    <div class="app-container">
        <h1>Blitz Dates</h1>
        <div id="statusMessage"></div>

        <!-- Nickname Input Screen -->
        <div id="nicknameScreen" class="screen active">
            <h2>Вітаємо!</h2>
            <label for="mainNicknameInput">Введіть ваш нікнейм:</label>
            <input type="text" id="mainNicknameInput" placeholder="Ваш унікальний нікнейм">
            <button id="continueToLobbyBtn">Продовжити</button>
            <div>
                <label for="wsAddressInputGlobal" style="font-size:0.9em; margin-top:30px;">Адреса WebSocket Сервера (напр., ws://localhost:8080):</label>
                <input type="text" id="wsAddressInputGlobal" value="ws://localhost:8080" style="font-size:0.9em;">
            </div>
        </div>

        <!-- Main Lobby Screen -->
        <div id="lobbyScreen" class="screen">
            <h2>Головне Лоббі</h2>
            <div class="lobby-options">
                <button id="showCreateRoomScreenBtn">Створити Кімнату</button>
                <button id="showJoinRoomScreenBtn">Приєднатися до Кімнати</button>
                <button id="startSoloGameBtn">Соло-режим</button>
            </div>
        </div>

        <!-- Create Room Screen -->
        <div id="createRoomScreen" class="screen">
            <h2>Створити Нову Кімнату</h2>
            <div class="form-section">
                <label for="createRoomName">Назва кімнати:</label>
                <input type="text" id="createRoomName" placeholder="Назва моєї кімнати">
                <label for="createRoomPassword">Пароль (необов'язково):</label>
                <input type="password" id="createRoomPassword" placeholder="Залиште пустим для відкритої кімнати">
                <label for="createRoomTopic">Тема:</label>
                <select id="createRoomTopic">
                    <option value="all_ukraine_history">Історія України (Всі)</option>
                    <option value="ancient_ukraine">Стародавня історія України</option>
                    <option value="rus_ukraine">Русь-Україна</option>
                    <option value="khmelnytsky_uprising">Нац.-визвольна війна (Б. Хмельницький)</option>
                    <option value="ukraine_ww2">Україна в Другій світовій війні</option>
                    <option value="ukraine_independence_restoration">Відновлення незалежності України</option>
                    <option value="ukraine_new_era">Творення нової України</option>
                    <!-- Добавьте ключи для всех ваших тем -->
                </select>
                <label for="createGameMode">Режим гри:</label>
                <select id="createGameMode">
                    <option value="basic">Basic (Подія -> Дата)</option>
                    <option value="reverse">Reverse (Дата -> Подія)</option>
                </select>
                <label for="createLivesCount">Кількість життів:</label>
                <select id="createLivesCount">
                    <option value="3">3 життя</option>
                    <option value="5">5 життів</option>
                </select>
                <label for="createQuestionsCount">Кількість питань в раунді:</label>
                <input type="number" id="createQuestionsCount" value="10" min="5" max="25">
            </div>
            <button id="submitCreateRoomBtn">Створити</button>
            <button class="back-to-lobby">Назад в Лоббі</button>
        </div>
        
        <!-- Join Room Screen -->
        <div id="joinRoomScreen" class="screen">
            <h2>Приєднатися до Кімнати</h2>
            <button id="refreshRoomListBtn">Оновити Список</button>
            <div id="roomListContainer">
                <p>Натисніть "Оновити Список" або очікуйте...</p>
            </div>
             <div class="form-section" id="joinSelectedRoomForm" style="display:none;">
                <h3 id="selectedRoomNameDisplay"></h3>
                <label for="joinRoomPassword">Пароль (якщо потрібно):</label>
                <input type="password" id="joinRoomPassword" placeholder="Пароль кімнати">
                <button id="submitJoinRoomBtn">Увійти в Обрану Кімнату</button>
            </div>
            <button class="back-to-lobby">Назад в Лоббі</button>
        </div>

        <!-- Solo Game Settings Screen -->
        <div id="soloGameSettingsScreen" class="screen">
            <h2>Налаштування Соло-гри</h2>
             <div class="form-section">
                <label for="soloGameTopic">Тема:</label>
                <select id="soloGameTopic">
                    <option value="all_ukraine_history">Історія України (Всі)</option>
                    <option value="ancient_ukraine">Стародавня історія України</option>
                    <option value="rus_ukraine">Русь-Україна</option>
                    <option value="khmelnytsky_uprising">Нац.-визвольна війна (Б. Хмельницький)</option>
                    <option value="ukraine_ww2">Україна в Другій світовій війні</option>
                    <option value="ukraine_independence_restoration">Відновлення незалежності України</option>
                    <option value="ukraine_new_era">Творення нової України</option>
                </select>
                <label for="soloGameMode">Режим гри:</label>
                <select id="soloGameMode">
                    <option value="basic">Basic (Подія -> Дата)</option>
                    <option value="reverse">Reverse (Дата -> Подія)</option>
                </select>
                <label for="soloLivesCount">Кількість життів:</label>
                <select id="soloLivesCount">
                    <option value="3">3 життя</option>
                    <option value="5">5 життів</option>
                </select>
                <label for="soloQuestionCount">Кількість питань:</label>
                <input type="number" id="soloQuestionCount" value="10" min="5" max="30">
            </div>
            <button id="submitStartSoloGameBtn">Почати Соло-гру</button>
            <button class="back-to-lobby">Назад в Лоббі</button>
        </div>

        <!-- Waiting Screen (Multiplayer) -->
        <div id="waitingScreen" class="screen">
            <h2>Очікування гравців...</h2>
            <p>ID Кімнати: <strong id="waitingRoomIdDisplay"></strong> (поділіться з другом)</p>
            <div id="waitingPlayersList"></div>
            <p id="waitingStatusText">Очікуємо другого гравця...</p>
            <div id="waitingCountdown" class="countdown" style="display:none;">3</div>
            <button id="cancelWaitingBtn">Скасувати / Вийти</button>
        </div>
        
        <!-- Match Screen -->
        <div id="matchScreen" class="screen">
            <div class="match-top-bar">
                <div class="player-info" id="playerInfoLocal">
                    <h3 id="localPlayerName">Гравець 1 <span class="player-level" id="localPlayerLevel">(Рів. 1)</span></h3>
                    <p>Рахунок: <span id="localPlayerScore">0</span></p>
                    <div class="lives-container" id="localPlayerLives"></div>
                </div>
                <div class="player-info" id="playerInfoOpponent" style="display:none;">
                    <h3 id="opponentPlayerName">Гравець 2 <span class="player-level" id="opponentPlayerLevel">(Рів. 1)</span></h3>
                    <p>Рахунок: <span id="opponentPlayerScore">0</span></p>
                    <div class="lives-container" id="opponentPlayerLives"></div>
                </div>
            </div>

            <p class="question-progress" id="questionNumberDisplay">Питання 0 з 0</p>
            <div class="question-text-display" id="questionTextEl">Завантаження питання...</div>
            <div class="options-grid" id="optionsContainerEl"></div>
            <div class="brief-info-display" id="briefInfoEl" style="display:none;"></div>

            <div class="timer-container">
                <div class="timer-bar-outer">
                    <div class="timer-bar-inner" id="questionTimerFill"></div>
                </div>
                <p class="timer-text">Залишилось часу: <span id="questionTimeLeftDisplay">20</span>с</p>
            </div>

            <div class="match-bottom-bar">
                <p>Час матчу: <span id="matchTimerDisplay">00:00</span></p>
                <button id="leaveMatchBtn">Покинути Матч</button>
            </div>
        </div>

        <!-- Result Modal -->
        <div id="resultModal" class="screen">
            <div class="modal-content">
                <h2 id="resultModalTitle">Результати Раунду</h2>
                <table id="resultTable">
                    <thead>
                        <tr>
                            <th>Гравець</th>
                            <th>Очки</th>
                            <th>Правильно</th>
                            <th>Неправильно</th>
                            <th>Рівень</th>
                        </tr>
                    </thead>
                    <tbody id="resultTableBody"></tbody>
                </table>
                <div id="mistakesContainer" style="display:none;">
                    <h4>Ваші помилки:</h4>
                    <ul id="mistakesList"></ul>
                </div>
                <div class="modal-buttons">
                    <button id="rematchBtn">Реванш</button>
                    <button id="exitToLobbyFromModalBtn">Вийти в Лоббі</button>
                </div>
            </div>
        </div>
        
        <!-- Chat placeholder -->
        <div id="chatContainer"></div>
    </div>

    <script>
        // --- 0. CONFIG & GLOBAL VARS ---
        const QUESTION_TIME_LIMIT = 20; // ИЗМЕНЕНО НА 20 СЕКУНД
        const WS_RECONNECT_TIMEOUT = 5000; // 5 секунд на переподключение
        const LEVEL_THRESHOLDS = [0, 100, 250, 500, 1000, 2000, 5000, 10000, 20000]; 
        const LEVEL_NAMES = ["Новачок", "Знавець Дат", "Історик-Аматор", "Дослідник Часу", "Магістр Історії", "Хроно-Експерт", "Легенда Епох", "Володар Часу", "Божество Історії"];


        // --- 1. DOM Elements (получаем их один раз) ---
        const screens = {}; // Будет заполнено в DOMContentLoaded
        const domElements = {}; // Для остальных элементов

        document.addEventListener('DOMContentLoaded', () => {
            // Screens
            ['nickname', 'lobby', 'createRoom', 'joinRoom', 'soloSettings', 'waiting', 'match', 'resultModal'].forEach(id => screens[id] = document.getElementById(id + 'Screen'));

            // Profile Header
            domElements.profileBtn = document.getElementById('profileBtn');
            domElements.profileDropdown = document.getElementById('profileDropdown');
            domElements.profileDisplayNicknameEl = document.getElementById('profileDisplayNickname');
            domElements.profileLevelEl = document.getElementById('profileLevel');
            domElements.profileTotalScoreEl = document.getElementById('profileTotalScore');
            domElements.profileRoundsPlayedEl = document.getElementById('profileRoundsPlayed');
            domElements.profileWinsEl = document.getElementById('profileWins');
            domElements.profileAvgAccuracyEl = document.getElementById('profileAvgAccuracy');
            domElements.profileMatchHistoryEl = document.getElementById('profileMatchHistory');
            domElements.logoutBtn = document.getElementById('logoutBtn');
            
            // Nickname Screen
            domElements.mainNicknameInput = document.getElementById('mainNicknameInput');
            domElements.continueToLobbyBtn = document.getElementById('continueToLobbyBtn');
            domElements.wsAddressInputGlobal = document.getElementById('wsAddressInputGlobal');

            // Lobby Screen
            domElements.showCreateRoomScreenBtn = document.getElementById('showCreateRoomScreenBtn');
            domElements.showJoinRoomScreenBtn = document.getElementById('showJoinRoomScreenBtn');
            domElements.startSoloGameBtn = document.getElementById('startSoloGameBtn');

            // Create Room Screen
            domElements.createRoomNameInput = document.getElementById('createRoomName');
            domElements.createRoomPasswordInput = document.getElementById('createRoomPassword');
            domElements.createRoomTopicSelect = document.getElementById('createRoomTopic');
            domElements.createGameModeSelect = document.getElementById('createGameMode');
            domElements.createLivesCountSelect = document.getElementById('createLivesCount');
            domElements.createQuestionsCountInput = document.getElementById('createQuestionsCount');
            domElements.submitCreateRoomBtn = document.getElementById('submitCreateRoomBtn');

            // Join Room Screen
            domElements.refreshRoomListBtn = document.getElementById('refreshRoomListBtn');
            domElements.roomListContainer = document.getElementById('roomListContainer');
            domElements.joinSelectedRoomForm = document.getElementById('joinSelectedRoomForm');
            domElements.selectedRoomNameDisplay = document.getElementById('selectedRoomNameDisplay');
            domElements.joinRoomPasswordInput = document.getElementById('joinRoomPassword');
            domElements.submitJoinRoomBtn = document.getElementById('submitJoinRoomBtn');
            
            // Solo Game Settings Screen
            domElements.soloGameTopicSelect = document.getElementById('soloGameTopic');
            domElements.soloGameModeSelect = document.getElementById('soloGameMode');
            domElements.soloLivesCountSelect = document.getElementById('soloLivesCount');
            domElements.soloQuestionCountInput = document.getElementById('soloQuestionCount');
            domElements.submitStartSoloGameBtn = document.getElementById('submitStartSoloGameBtn');

            // Waiting Screen
            domElements.waitingRoomIdDisplay = document.getElementById('waitingRoomIdDisplay');
            domElements.waitingPlayersListEl = document.getElementById('waitingPlayersList');
            domElements.waitingStatusTextEl = document.getElementById('waitingStatusText');
            domElements.waitingCountdownEl = document.getElementById('waitingCountdown');
            domElements.cancelWaitingBtn = document.getElementById('cancelWaitingBtn');

            // Match Screen
            domElements.localPlayerNameEl = document.getElementById('localPlayerName');
            domElements.localPlayerLevelEl = document.getElementById('localPlayerLevel');
            domElements.localPlayerScoreEl = document.getElementById('localPlayerScore');
            domElements.localPlayerLivesContainer = document.getElementById('localPlayerLives');
            domElements.opponentPlayerNameEl = document.getElementById('opponentPlayerName');
            domElements.opponentPlayerLevelEl = document.getElementById('opponentPlayerLevel');
            domElements.opponentPlayerScoreEl = document.getElementById('opponentPlayerScore');
            domElements.opponentPlayerLivesContainer = document.getElementById('opponentPlayerLives');
            domElements.playerInfoOpponentDiv = document.getElementById('playerInfoOpponent');
            domElements.questionNumberDisplayEl = document.getElementById('questionNumberDisplay');
            domElements.questionTextEl = document.getElementById('questionTextEl');
            domElements.optionsContainerEl = document.getElementById('optionsContainerEl');
            domElements.briefInfoEl = document.getElementById('briefInfoEl');
            domElements.questionTimerFillEl = document.getElementById('questionTimerFill');
            domElements.questionTimeLeftDisplayEl = document.getElementById('questionTimeLeftDisplay');
            domElements.matchTimerDisplayEl = document.getElementById('matchTimerDisplay');
            domElements.leaveMatchBtn = document.getElementById('leaveMatchBtn');

            // Result Modal
            domElements.resultModalTitleEl = document.getElementById('resultModalTitle');
            domElements.resultTableBodyEl = document.getElementById('resultTableBody');
            domElements.mistakesContainerEl = document.getElementById('mistakesContainer');
            domElements.mistakesListEl = document.getElementById('mistakesList');
            domElements.rematchBtn = document.getElementById('rematchBtn');
            domElements.newTopicBtnModal = document.getElementById('newTopicBtnModal'); // пока не используется
            domElements.exitToLobbyFromModalBtn = document.getElementById('exitToLobbyFromModalBtn');

            domElements.statusMessageEl = document.getElementById('statusMessage');
            document.querySelectorAll('.back-to-lobby').forEach(btn => {
                btn.addEventListener('click', () => {
                    resetRoomState(); // Сбрасываем состояние комнаты при возврате в лобби
                    switchScreen('lobby');
                });
            });

            // Инициализация и загрузка данных
            loadProfile(); 
            setupEventListeners();
            const savedWSAddress = localStorage.getItem('blitzDatesWSAddress');
            if (savedWSAddress) domElements.wsAddressInputGlobal.value = savedWSAddress;
            
            if (localPlayer.nickname && localPlayer.nickname !== "Гість") {
                switchScreen('lobby');
            } else {
                switchScreen('nickname');
            }
        });
        

        // --- State Variables --- (перенесены сюда для ясности)
        let ws = null;
        let localPlayer = {
            id: null, nickname: "Гість", score: 0, lives: 3, isHost: false, answeredThisQuestion: false,
            stats: { totalScore: 0, level: 1, roundsPlayed: 0, wins: 0, correctAnswersSum: 0, totalQuestionsAnsweredSum: 0, matchHistory: [] }
        };
        let opponentPlayer = null;
        let currentRoom = { id: null, name: "", settings: {}, players: [] };
        let currentMatch = { questions: [], currentQuestionIndex: -1, totalQuestionsInMatch: 0, isSolo: false, currentQuestionData: null };
        
        let questionTimerInterval = null;
        let questionTimeLeft = QUESTION_TIME_LIMIT;
        let matchTimerInterval = null;
        let matchTimeElapsed = 0;
        let countdownInterval = null;
        let waitingTimeout = null;
        let selectedRoomToJoinId = null;

        // --- Utility & UI Functions ---
        function showStatus(message, type = 'info', duration = 4000) {
            if (!domElements.statusMessageEl) return;
            domElements.statusMessageEl.textContent = message;
            domElements.statusMessageEl.className = ''; 
            domElements.statusMessageEl.classList.add(type);
            domElements.statusMessageEl.style.display = 'block';
            setTimeout(() => { if(domElements.statusMessageEl) domElements.statusMessageEl.style.display = 'none'; }, duration);
        }

        function switchScreen(screenId) {
            Object.values(screens).forEach(s => s.classList.remove('active'));
            if (screens[screenId]) {
                screens[screenId].classList.add('active');
            } else {
                console.error("Screen not found by switchScreen:", screenId);
            }
        }
        function shuffleArray(array) { /* ... (без изменений) ... */ return array; }
        function formatTime(totalSeconds) { /* ... (без изменений) ... */ return `${String(Math.floor(totalSeconds / 60)).padStart(2, '0')}:${String(totalSeconds % 60).padStart(2, '0')}`; }
        
        function getPlayerLevelDetails(totalScore) {
            let level = 1;
            for (let i = LEVEL_THRESHOLDS.length - 1; i >= 0; i--) {
                if (totalScore >= LEVEL_THRESHOLDS[i]) {
                    level = i + 1;
                    break;
                }
            }
            level = Math.min(level, LEVEL_NAMES.length);
            return { number: level, name: LEVEL_NAMES[level - 1] };
        }

        // --- Profile & Stats ---
        function loadProfile() { /* ... (без изменений, но будет вызываться updateProfileUI) ... */ 
             const savedProfile = localStorage.getItem('blitzDatesUserProfile');
            if (savedProfile) {
                const parsedProfile = JSON.parse(savedProfile);
                localPlayer.nickname = parsedProfile.nickname || "Гість";
                localPlayer.stats = parsedProfile.stats || { totalScore: 0, level: 1, roundsPlayed: 0, wins:0, correctAnswersSum: 0, totalQuestionsAnsweredSum: 0, matchHistory: [] };
            }
            if(domElements.mainNicknameInput) domElements.mainNicknameInput.value = localPlayer.nickname === "Гість" ? "" : localPlayer.nickname;
            updateProfileUI();
        }
        function saveProfile() { /* ... (без изменений) ... */ 
            const profileToSave = { nickname: localPlayer.nickname, stats: localPlayer.stats };
            localStorage.setItem('blitzDatesUserProfile', JSON.stringify(profileToSave));
            updateProfileUI();
        }

        function updateProfileUI() {
            if (!domElements.profileDisplayNicknameEl) return; // Если DOM еще не готов
            const levelDetails = getPlayerLevelDetails(localPlayer.stats.totalScore);
            localPlayer.stats.level = levelDetails.number; // Обновляем уровень в локальном состоянии

            domElements.profileDisplayNicknameEl.textContent = localPlayer.nickname;
            domElements.profileLevelEl.textContent = `${levelDetails.number} (${levelDetails.name})`;
            domElements.profileTotalScoreEl.textContent = localPlayer.stats.totalScore;
            domElements.profileRoundsPlayedEl.textContent = localPlayer.stats.roundsPlayed;
            domElements.profileWinsEl.textContent = localPlayer.stats.wins || 0;
            const avgAcc = localPlayer.stats.totalQuestionsAnsweredSum > 0 ?
                ((localPlayer.stats.correctAnswersSum / localPlayer.stats.totalQuestionsAnsweredSum) * 100).toFixed(0) : 0;
            domElements.profileAvgAccuracyEl.textContent = avgAcc;

            domElements.profileMatchHistoryEl.innerHTML = '';
            if (localPlayer.stats.matchHistory.length === 0) {
                domElements.profileMatchHistoryEl.innerHTML = '<li>Історія порожня</li>';
            } else {
                localPlayer.stats.matchHistory.slice(-5).reverse().forEach(match => {
                    const li = document.createElement('li');
                    const matchDate = new Date(match.date).toLocaleDateString('uk-UA', { day: '2-digit', month: '2-digit', year: '2-digit'});
                    const opponentText = match.opponent ? `проти ${match.opponent}` : '';
                    li.textContent = `${matchDate} - ${match.mode === 'solo' ? 'Соло' : 'МП'} ${opponentText}: ${match.score} оч., ${match.accuracy}%`;
                    domElements.profileMatchHistoryEl.appendChild(li);
                });
            }
        }
        
        function addMatchToHistory(isSolo, score, correctCount, totalQInMatch, opponentNickname = null, win = false) {
            localPlayer.stats.roundsPlayed = (localPlayer.stats.roundsPlayed || 0) + 1;
            localPlayer.stats.totalScore = (localPlayer.stats.totalScore || 0) + score;
            localPlayer.stats.correctAnswersSum = (localPlayer.stats.correctAnswersSum || 0) + correctCount;
            localPlayer.stats.totalQuestionsAnsweredSum = (localPlayer.stats.totalQuestionsAnsweredSum || 0) + totalQInMatch;
            if (win) localPlayer.stats.wins = (localPlayer.stats.wins || 0) + 1;

            const accuracy = totalQInMatch > 0 ? ((correctCount / totalQInMatch) * 100).toFixed(0) : 0;
            localPlayer.stats.matchHistory = localPlayer.stats.matchHistory || [];
            localPlayer.stats.matchHistory.push({
                date: new Date().toISOString(),
                mode: isSolo ? 'solo' : 'multiplayer',
                opponent: isSolo ? null : opponentNickname,
                score: score,
                accuracy: parseInt(accuracy),
            });
            if(localPlayer.stats.matchHistory.length > 20) localPlayer.stats.matchHistory.shift();
            saveProfile();
        }

        // --- WebSocket ---
        function connectWebSocket() { /* ... (без изменений, но убедитесь, что WS_RECONNECT_TIMEOUT не используется для авто-реконнекта без логики) ... */ 
            const wsAddress = domElements.wsAddressInputGlobal.value.trim();
            if (!wsAddress) { showStatus("Будь ласка, введіть адресу WebSocket сервера.", "error"); return false; }
            if (ws && (ws.readyState === WebSocket.OPEN || ws.readyState === WebSocket.CONNECTING)) { return true; }
            if (ws) { ws.close(); }

            showStatus(`Підключення до ${wsAddress}...`, "info", 2000);
            try { ws = new WebSocket(wsAddress); } 
            catch (e) { showStatus(`Помилка WebSocket: ${e.message}.`, "error"); return false; }

            ws.onopen = () => { showStatus("Підключено до WebSocket сервера!", "success"); localStorage.setItem('blitzDatesWSAddress', wsAddress); };
            ws.onmessage = (event) => { try { const message = JSON.parse(event.data); console.log("SERVER -> CLIENT:", message); handleServerMessage(message); } catch (e) { console.error("Parse error:", e, event.data); showStatus("Некоректне повідомлення.", "error");}};
            ws.onerror = (error) => { console.error("WebSocket Error:", error); showStatus(`Помилка WebSocket.`, "error"); ws = null;};
            ws.onclose = (event) => { 
                const msg = `WebSocket з'єднання закрито (код: ${event.code}).`;
                showStatus(msg, event.code === 1000 ? "info" : "error");
                ws = null; 
                if (screens.match.classList.contains('active') || screens.waiting.classList.contains('active')) {
                    resetGameToLobby("З'єднання з сервером втрачено.");
                }
            };
            return true;
        }
        function sendToServer(data) { /* ... (без изменений, но возможно, стоит убрать авто-реконнект отсюда, пусть пользователь сам инициирует) ... */
             if (ws && ws.readyState === WebSocket.OPEN) {
                console.log("CLIENT -> SERVER:", data);
                ws.send(JSON.stringify(data));
            } else {
                showStatus("Немає з'єднання з сервером. Спробуйте дію ще раз.", "error");
                console.error("WebSocket is not connected. Current state:", ws ? ws.readyState : 'ws is null');
                // Не пытаемся реконнектиться автоматически при каждой отправке,
                // пусть пользователь сам переподключается через UI, если нужно
            }
        }
        
        function handleServerMessage(msg) {
            switch (msg.type) {
                case 'connection_ack':
                    localPlayer.id = msg.playerId;
                    if (msg.playerStats) { // Обновляем общую статистику при подключении
                        localPlayer.stats = { ...localPlayer.stats, ...msg.playerStats };
                        updateProfileUI();
                    }
                    break;
                case 'room_created':
                    currentRoom.id = msg.roomId;
                    // localPlayer.id уже должен быть установлен из connection_ack
                    localPlayer.isHost = true;
                    domElements.waitingRoomIdDisplay.textContent = currentRoom.id;
                    // Обновляем currentRoom на клиенте данными с сервера, если они есть
                    if(msg.roomSettings) currentRoom.settings = msg.roomSettings;
                    currentRoom.players = [{id: localPlayer.id, nickname: localPlayer.nickname, isHost: true, lives: currentRoom.settings?.lives || 3, score: 0}];
                    updateWaitingPlayerList();
                    domElements.waitingStatusTextEl.textContent = "Кімната створена. Надішліть ID другу та очікуйте його підключення...";
                    switchScreen('waiting');
                    clearTimeout(waitingTimeout);
                    waitingTimeout = setTimeout(() => {
                        if (screens.waiting.classList.contains('active') && localPlayer.isHost && currentRoom.id && currentRoom.players.length < 2) {
                            showStatus("Час очікування вийшов. Кімната закрита.", "info");
                            sendToServer({ type: 'close_room', roomId: currentRoom.id, playerId: localPlayer.id }); 
                            resetGameToLobby();
                        }
                    }, 60000); // 60 секунд ожидания
                    break;
                case 'join_success': 
                    currentRoom.id = msg.roomId;
                    // localPlayer.id уже установлен
                    localPlayer.isHost = false; // Гость не хост
                    currentRoom.name = msg.roomDetails.name;
                    currentRoom.settings = { // Сохраняем настройки комнаты
                        topic: msg.roomDetails.topic,
                        mode: msg.roomDetails.mode,
                        lives: msg.roomDetails.lives,
                        questionsPerRound: msg.roomDetails.questionsPerRound || 10
                    };
                    currentRoom.players = msg.roomDetails.playersInfo.map(p => ({...p, lives: currentRoom.settings.lives, score: 0 })); // Сброс жизней/очков при входе
                    updateWaitingPlayerList();
                    domElements.waitingStatusTextEl.textContent = `Успішно приєднано до "${currentRoom.name}". Очікуємо початку...`;
                    switchScreen('waiting');
                    break;
                case 'player_joined': 
                    currentRoom.players = msg.playersInfo.map(p => ({...p, lives: currentRoom.settings?.lives || p.lives, score: p.score || 0}));
                    updateWaitingPlayerList();
                     const joinedPlayer = msg.playersInfo.find(p => p.playerId === msg.playerId);
                    if(localPlayer.isHost && currentRoom.players.length === 2){
                         domElements.waitingStatusTextEl.textContent = `Гравець ${joinedPlayer?.nickname || msg.nickname} приєднався!`;
                    }
                    // Сервер должен инициировать countdown_started
                    break;
                case 'countdown_started':
                    startCountdown(msg.duration || 3);
                    break;
                case 'match_started':
                    currentMatch.isSolo = false;
                    currentMatch.totalQuestionsInMatch = msg.totalQuestions;
                    currentRoom.settings = msg.settings; // Обновляем настройки комнаты актуальными с сервера

                    msg.playersInfo.forEach(serverPlayer => {
                        if (serverPlayer.playerId === localPlayer.id) {
                            localPlayer.score = serverPlayer.score;
                            localPlayer.lives = serverPlayer.lives;
                            localPlayer.stats.level = serverPlayer.level || getPlayerLevelDetails(localPlayer.stats.totalScore).number; // Уровень с сервера
                        } else {
                            opponentPlayer = { id: serverPlayer.playerId, nickname: serverPlayer.nickname, score: serverPlayer.score, lives: serverPlayer.lives, level: serverPlayer.level || 1 };
                        }
                    });
                    
                    currentMatch.currentQuestionIndex = -1; 
                    currentMatch.questions = []; // Сервер будет присылать вопросы по одному
                    
                    switchScreen('match');
                    updateMatchPlayerUI();
                    startMatchTimer();
                    // Первый вопрос придет с 'new_question'
                    break;
                case 'new_question':
                    currentMatch.currentQuestionIndex = msg.questionIndex;
                    currentMatch.currentQuestionData = msg.questionData; // Сохраняем данные текущего вопроса
                    renderQuestion(msg.questionData);
                    break;
                case 'answer_result':
                    msg.playersData.forEach(serverPlayer => {
                        if (serverPlayer.playerId === localPlayer.id) {
                            localPlayer.score = serverPlayer.score;
                            localPlayer.lives = serverPlayer.lives;
                        } else if (opponentPlayer && serverPlayer.playerId === opponentPlayer.id) {
                            opponentPlayer.score = serverPlayer.score;
                            opponentPlayer.lives = serverPlayer.lives;
                        }
                    });
                    updateMatchPlayerUI();
                    markOptionsAfterResult(msg.correctOptionIndex, msg.questionBriefInfo, msg.playersData);
                    
                    // Задержка перед запросом следующего вопроса или ожиданием от сервера
                    setTimeout(() => {
                        if (localPlayer.lives > 0 && (!opponentPlayer || opponentPlayer.lives > 0) && 
                            currentMatch.currentQuestionIndex < currentMatch.totalQuestionsInMatch - 1) {
                            // Клиент может ничего не делать, сервер пришлет 'new_question'
                            // Или, если протокол предполагает, клиент может запросить следующий вопрос:
                            // sendToServer({ type: 'request_next_question', roomId: currentRoom.id });
                            console.log("Очікуємо наступне питання від сервера...");
                        } else {
                            // Игра окончена по условиям клиента (жизни/вопросы)
                            // но сервер должен прислать 'round_end' для официального завершения
                             console.log("Очікуємо 'round_end' від сервера...");
                        }
                    }, 2000);
                    break;
                case 'round_end':
                    const localPResult = msg.results.find(r => r.playerId === localPlayer.id);
                    const opponentPResult = msg.results.find(r => r.playerId !== localPlayer.id && opponentPlayer && r.playerId === opponentPlayer.id);
                    let localPlayerWon = false;
                    if (localPResult && opponentPResult) {
                        localPlayerWon = localPResult.score > opponentPResult.score;
                    } else if (localPResult && !opponentPResult) { // Если оппонент вышел, и игра завершилась для локального
                        localPlayerWon = localPResult.lives > 0;
                    }
                    addMatchToHistory(false, localPResult?.score || 0, localPResult?.correctCount || 0, currentMatch.totalQuestionsInMatch, opponentPlayer?.nickname, localPlayerWon);
                    showResultModal(msg.results, msg.mistakes && msg.mistakes[localPlayer.id] ? msg.mistakes[localPlayer.id] : []);
                    break;
                 case 'player_mistakes_summary': // Теперь это отдельное сообщение для ошибок
                    displayMistakes(msg.mistakes || []);
                    break;
                case 'level_up':
                    showStatus(`🎉 Новий рівень! ${msg.levelName} (Рівень ${msg.newLevel}) 🎉`, "success", 7000);
                    localPlayer.stats.level = msg.newLevel; // Обновляем локальный статс
                    updateProfileUI(); // Обновить отображение в профиле
                    break;    
                case 'player_left': /* ... (без изменений) ... */ 
                    showStatus(`Гравець '${msg.nickname}' покинув кімнату.`, "info");
                    if (screens.match.classList.contains('active')) {
                         opponentPlayer = null; // Убираем оппонента
                         domElements.playerInfoOpponentDiv.style.display = 'none';
                         showStatus("Суперник вийшов. Ви можете продовжити гру (якщо сервер підтримує) або покинути матч.", "info", 7000);
                        // Сервер должен решить, завершать ли матч или позволить продолжить
                    } else if (screens.waiting.classList.contains('active')) {
                        currentRoom.players = currentRoom.players.filter(p => p.id !== msg.playerId);
                        updateWaitingPlayerList();
                        domElements.waitingStatusTextEl.textContent = "Суперник вийшов. Очікуємо нового гравця...";
                    }
                    break;
                case 'room_list': domElements.roomListContainer.innerHTML = ''; renderRoomList(msg.rooms); break;
                case 'error': showStatus(`Помилка: ${msg.message}`, "error"); if(msg.context === 'join_room') { selectedRoomToJoinId = null; domElements.joinSelectedRoomForm.style.display = 'none';} break;
                default: console.warn("Невідомий тип повідомлення від сервера:", msg.type);
            }
        }
        
        function updateWaitingPlayerList(){
            domElements.waitingPlayersListEl.innerHTML = '';
            currentRoom.players.forEach(p => {
                const li = document.createElement('li');
                li.textContent = p.nickname + (p.id === localPlayer.id ? " (Ви)" : "") + (p.isHost ? " (Хост)" : "");
                domElements.waitingPlayersListEl.appendChild(li);
            });
        }

        function startCountdown(duration = 3) { /* ... (без изменений) ... */ }
        
        function renderRoomList(rooms) {
            domElements.roomListContainer.innerHTML = '';
            if (!rooms || rooms.length === 0) {
                domElements.roomListContainer.innerHTML = '<p>Активних кімнат немає.</p>'; return;
            }
            rooms.forEach(room => {
                const item = document.createElement('div');
                item.classList.add('room-list-item');
                item.dataset.roomId = room.id;
                item.dataset.roomName = room.name;
                item.dataset.requiresPassword = room.passwordProtected;
                
                let statusText = `<span class="room-name">${room.name} (${room.playerCount}/2)</span>`;
                statusText += `<span>Тема: ${room.topicReadable || room.topic}</span>`;
                if (room.passwordProtected) statusText += '<span><img src="data:image/svg+xml;charset=UTF-8,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 24 24%22 fill=%22white%22 width=%2218px%22 height=%2218px%22%3E%3Cpath d=%22M0 0h24v24H0z%22 fill=%22none%22/%3E%3Cpath d=%22M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1s3.1 1.39 3.1 3.1v2z%22/%3E%3C/svg%3E</span>'; // Lock icon
                
                item.innerHTML = statusText;
                item.onclick = () => { /* ... (логика выбора комнаты без изменений) ... */ 
                     document.querySelectorAll('.room-list-item').forEach(el => el.classList.remove('selected-room'));
                    item.classList.add('selected-room');
                    selectedRoomToJoinId = room.id;
                    domElements.selectedRoomNameDisplay.textContent = `Кімната: ${room.name}`;
                    domElements.joinRoomPasswordInput.value = '';
                    domElements.joinRoomPasswordInput.disabled = !room.passwordProtected;
                    domElements.joinSelectedRoomForm.style.display = 'block';
                };
                domElements.roomListContainer.appendChild(item);
            });
        }

        // --- Game Flow & UI (Match) ---
        function updateMatchPlayerUI() {
            const localLevelDetails = getPlayerLevelDetails(localPlayer.stats.totalScore);
            domElements.localPlayerNameEl.innerHTML = `${localPlayer.nickname} (Ви) <span class="player-level" id="localPlayerLevel">(Рів. ${localLevelDetails.number})</span>`;
            domElements.localPlayerScoreEl.textContent = localPlayer.score;
            renderLives(domElements.localPlayerLivesContainer, localPlayer.lives, currentMatch.isSolo ? parseInt(domElements.soloLivesCountSelect.value) : currentRoom.settings?.lives || 3);

            if (opponentPlayer) {
                const opponentLevelDetails = getPlayerLevelDetails(opponentPlayer.stats?.totalScore || 0); // Если статы оппонента приходят
                domElements.opponentPlayerNameEl.innerHTML = `${opponentPlayer.nickname} <span class="player-level" id="opponentPlayerLevel">(Рів. ${opponentLevelDetails.number})</span>`;
                domElements.opponentPlayerScoreEl.textContent = opponentPlayer.score;
                renderLives(domElements.opponentPlayerLivesContainer, opponentPlayer.lives, currentRoom.settings?.lives || 3);
                domElements.playerInfoOpponentDiv.style.display = 'block';
            } else {
                 domElements.playerInfoOpponentDiv.style.display = 'none';
            }
        }

        function renderLives(container, livesCount, maxLives) {
            container.innerHTML = '';
            const max = maxLives || (currentMatch.isSolo ? parseInt(domElements.soloLivesCountSelect.value) : currentRoom.settings?.lives || 3);
            for (let i = 0; i < max; i++) {
                const heart = document.createElement('span');
                heart.classList.add('life-heart');
                heart.textContent = '❤️';
                if (i >= livesCount) heart.classList.add('lost');
                container.appendChild(heart);
            }
        }

        function renderQuestion(questionData) { 
            localPlayer.answeredThisQuestion = false; // Сбрасываем флаг ответа для нового вопроса
            domElements.questionTextEl.textContent = questionData.questionText;
            domElements.questionNumberDisplayEl.textContent = `Питання ${currentMatch.currentQuestionIndex + 1} з ${currentMatch.totalQuestionsInMatch}`;
            
            domElements.optionsContainerEl.innerHTML = '';
            questionData.options.forEach((optionText, index) => {
                const button = document.createElement('button');
                button.classList.add('option-button');
                button.textContent = optionText;
                button.dataset.index = index; 
                button.disabled = false; // Кнопки должны быть активны
                button.onclick = handleOptionClick;
                domElements.optionsContainerEl.appendChild(button);
            });
            domElements.briefInfoEl.style.display = 'none'; 
            domElements.briefInfoEl.textContent = '';
            startQuestionTimer(); // Перезапускаем таймер
        }
        
        function handleOptionClick(event) { /* ... (без изменений) ... */ 
            if (localPlayer.answeredThisQuestion) return;
            localPlayer.answeredThisQuestion = true;

            clearInterval(questionTimerInterval); // Останавливаем таймер НЕМЕДЛЕННО
            const chosenIdx = parseInt(event.target.dataset.index);
            // Время, ОСТАВШЕЕСЯ на таймере, когда игрок ответил. Если 0, значит время вышло до клика, но это обработает таймер.
            // Если timeTaken, то QUESTION_TIME_LIMIT - questionTimeLeft
            const answerTime = questionTimeLeft; // Оставшееся время для бонуса

            event.target.classList.add('selected');
            domElements.optionsContainerEl.querySelectorAll('.option-button').forEach(btn => btn.disabled = true);

            if (currentMatch.isSolo) {
                processSoloAnswer(chosenIdx, QUESTION_TIME_LIMIT - answerTime); // Передаем потраченное время
            } else {
                sendToServer({
                    type: "answer", playerId: localPlayer.id, roomId: currentRoom.id,
                    questionId: currentMatch.currentQuestionData.id, // Используем ID из сохраненных данных вопроса
                    chosenOptionIndex: chosenIdx, 
                    answerTimeSec: QUESTION_TIME_LIMIT - answerTime // Отправляем ПОТРАЧЕННОЕ время
                });
            }
        }
        
        function startQuestionTimer() {
            clearInterval(questionTimerInterval); // Очищаем любой предыдущий интервал
            questionTimeLeft = QUESTION_TIME_LIMIT;
            domElements.questionTimeLeftDisplayEl.textContent = questionTimeLeft;
            
            // Сброс прогресс-бара
            domElements.questionTimerFillEl.style.transition = 'none'; // Убираем анимацию для мгновенного сброса
            domElements.questionTimerFillEl.style.width = '100%';    // Ставим на 100%
            
            // Форсируем reflow, чтобы браузер применил 100% перед новой анимацией
            // Это трюк, чтобы transition сработал при повторном изменении width
            void domElements.questionTimerFillEl.offsetWidth; 
            
            // Устанавливаем новую анимацию и запускаем ее
            domElements.questionTimerFillEl.style.transition = `width ${QUESTION_TIME_LIMIT}s linear`;
            domElements.questionTimerFillEl.style.width = '0%';
            
            questionTimerInterval = setInterval(() => {
                questionTimeLeft--;
                domElements.questionTimeLeftDisplayEl.textContent = questionTimeLeft;

                if (questionTimeLeft <= 0) {
                    clearInterval(questionTimerInterval);
                    if (!localPlayer.answeredThisQuestion) {
                        localPlayer.answeredThisQuestion = true;
                        domElements.optionsContainerEl.querySelectorAll('.option-button').forEach(btn => btn.disabled = true);
                        showStatus("Час вийшов!", "info", 1500);
                        if (currentMatch.isSolo) {
                            processSoloAnswer(null, QUESTION_TIME_LIMIT); 
                        } else {
                            sendToServer({
                                type: "answer", playerId: localPlayer.id, roomId: currentRoom.id,
                                questionId: currentMatch.currentQuestionData.id,
                                chosenOptionIndex: null, answerTimeSec: QUESTION_TIME_LIMIT
                            });
                        }
                    }
                }
            }, 1000);
        }
        
        function markOptionsAfterResult(correctOptionIndex, briefInfoText, playersData) {
            // Находим кнопку, которую выбрал ЛОКАЛЬНЫЙ игрок (если он отвечал)
            let localPlayerChoiceIndex = -1;
            if (playersData) {
                const localPlayerData = playersData.find(p => p.playerId === localPlayer.id);
                if (localPlayerData && localPlayerData.lastAnswer && typeof localPlayerData.lastAnswer.chosenOptionIndex === 'number') {
                    localPlayerChoiceIndex = localPlayerData.lastAnswer.chosenOptionIndex;
                }
            }

            domElements.optionsContainerEl.querySelectorAll('.option-button').forEach((btn, idx) => {
                btn.disabled = true;
                btn.classList.remove('selected'); // Убираем предварительное выделение

                if (idx === correctOptionIndex) {
                    btn.classList.add('correct');
                } else if (idx === localPlayerChoiceIndex) { // Если это выбор игрока и он неправильный
                    btn.classList.add('wrong');
                } else {
                    btn.classList.add('disabled-after-reveal'); // Остальные неправильные опции
                }
            });

            if (briefInfoText) {
                domElements.briefInfoEl.textContent = briefInfoText;
                domElements.briefInfoEl.style.display = 'block';
            }
        }
        
        function loadNextOrFinishAfterServerResult() { /* ... (логика ожидания `new_question` или `round_end` от сервера) ... */ }
        function loadNextQuestionFlow() { /* ... (без изменений) ... */ }
        function startMatchTimer() { /* ... (без изменений) ... */ }

        // --- Solo Mode ---
        function startSoloGame() { /* ... (убедитесь, что QUESTION_TIME_LIMIT используется правильно) ... */ 
             currentMatch.isSolo = true;
            opponentPlayer = null; 
            domElements.playerInfoOpponentDiv.style.display = 'none';

            const topic = domElements.soloGameTopicSelect.value;
            const mode = domElements.soloGameModeSelect.value;
            localPlayer.lives = parseInt(domElements.soloLivesCountSelect.value);
            currentMatch.totalQuestionsInMatch = parseInt(domElements.soloQuestionCountInput.value);

            let sourceQuestions = ALL_HISTORICAL_EVENTS_CLIENT; // Используем клиентскую копию для соло
            if (topic !== 'all_ukraine_history') {
                sourceQuestions = ALL_HISTORICAL_EVENTS_CLIENT.filter(e => e.topic_key === topic);
            }
            if (sourceQuestions.length === 0) { showStatus("Для теми немає даних.", "error"); return; }
            
            currentMatch.questions = shuffleArray([...sourceQuestions])
                .slice(0, currentMatch.totalQuestionsInMatch)
                .map((eventData, index) => {
                    const qId = `solo_q_${index}`;
                    let questionText, options = [], correctOptVal;

                    if (mode === 'basic') { // Event -> Date
                        questionText = `В якому році відбулася подія: "${eventData.event}"?`;
                        correctOptVal = eventData.date;
                        options.push(eventData.date);
                        const distractors = shuffleArray(ALL_HISTORICAL_EVENTS_CLIENT.filter(e => e.id !== eventData.id).map(e => e.date));
                        for (let d of distractors) { if (options.length < 4 && !options.includes(d)) options.push(d); if (options.length >= 4) break; }
                    } else { // Date -> Event
                        questionText = `Яка подія відбулася ${eventData.date}?`;
                        correctOptVal = eventData.event;
                        options.push(eventData.event);
                        const distractors = shuffleArray(ALL_HISTORICAL_EVENTS_CLIENT.filter(e => e.id !== eventData.id).map(e => e.event));
                        for (let d of distractors) { if (options.length < 4 && !options.includes(d)) options.push(d); if (options.length >= 4) break; }
                    }
                    let dummyCnt = 1;
                    while(options.length < 4) { options.push(`${mode === 'basic' ? 'Інша дата' : 'Інша подія'} #${dummyCnt++}`); if(dummyCnt > 20) break; }
                    
                    options = shuffleArray(options);
                    const correctIndex = options.indexOf(correctOptVal);
                    if (correctIndex === -1) { options[0] = correctOptVal; return { id: qId, questionText, options, correctIndex: 0, briefInfo: eventData.brief, playerAnswered: false, playerAnswerCorrect: false }; }
                    return { id: qId, questionText, options, correctIndex, briefInfo: eventData.brief, playerAnswered: false, playerAnswerCorrect: false, playerChosenIndex: -1 };
                });
            
            if (currentMatch.questions.length < currentMatch.totalQuestionsInMatch) {
                showStatus(`Недостатньо питань. Згенеровано ${currentMatch.questions.length}.`, "info");
                currentMatch.totalQuestionsInMatch = currentMatch.questions.length;
            }
            if(currentMatch.totalQuestionsInMatch === 0){ showStatus("Немає питань для соло-гри.", "error"); return; }

            localPlayer.score = 0;
            currentMatch.currentQuestionIndex = -1;
            
            switchScreen('match');
            updateMatchPlayerUI();
            startMatchTimer();
            loadNextQuestionFlow();
        }
        function processSoloAnswer(chosenIdx, timeTaken) { /* ... (изменено время, убедитесь, что playerChosenIndex сохраняется для отображения ошибок) ... */ 
            const currentQ = currentMatch.questions[currentMatch.currentQuestionIndex];
            currentQ.playerAnswered = true;
            currentQ.playerChosenIndex = chosenIdx; // Сохраняем выбор игрока
            let isCorrect = false;

            if (chosenIdx !== null && chosenIdx === currentQ.correctIndex) {
                isCorrect = true;
                currentQ.playerAnswerCorrect = true;
                localPlayer.score += 10;
                if (timeTaken < QUESTION_TIME_LIMIT) { // QUESTION_TIME_LIMIT теперь 20
                    localPlayer.score += (QUESTION_TIME_LIMIT - timeTaken);
                }
            } else {
                localPlayer.lives--;
                currentQ.playerAnswerCorrect = false;
            }
            updateMatchPlayerUI();
            markOptionsAfterResult(currentQ.correctIndex, currentQ.briefInfo, null); // В соло нет playersData от сервера

            setTimeout(() => { loadNextQuestionFlow(); }, 2000);
        }
        function showResultModalForSolo() { /* ... (убедитесь, что используется playerChosenIndex для показа ошибок) ... */
            clearInterval(questionTimerInterval); clearInterval(matchTimerInterval);
            domElements.resultModalTitleEl.textContent = "Результати Соло-гри";
            screens.match.classList.remove('active');
            screens.resultModal.style.display = 'flex';

            const correctAnswers = currentMatch.questions.filter(q => q.playerAnswerCorrect).length;
            const wrongAnswers = currentMatch.totalQuestionsInMatch - correctAnswers;
            const localLevelDetails = getPlayerLevelDetails(localPlayer.stats.totalScore + localPlayer.score); // Предварительный расчет уровня

            domElements.resultTableBodyEl.innerHTML = `
                <tr>
                    <td>${localPlayer.nickname} (Ви)</td>
                    <td>${localPlayer.score}</td>
                    <td>${correctAnswers}</td>
                    <td>${wrongAnswers}</td>
                    <td>${localLevelDetails.number} (${localLevelDetails.name})</td>
                </tr>
            `;
            
            const mistakes = currentMatch.questions.filter(q => q.playerAnswered && !q.playerAnswerCorrect);
            displayMistakes(mistakes); // Используем общую функцию для отображения ошибок
            
            domElements.rematchBtn.textContent = "Грати ще раз (Соло)";
            addMatchToHistory(true, localPlayer.score, correctAnswers, currentMatch.totalQuestionsInMatch, null, localPlayer.lives > 0);
        }
        
        function displayMistakes(mistakesArray) { // Общая функция для показа ошибок
             if (mistakesArray && mistakesArray.length > 0) {
                domElements.mistakesContainerEl.style.display = 'block';
                domElements.mistakesListEl.innerHTML = '';
                mistakesArray.forEach(q => {
                    const li = document.createElement('li');
                    // Для соло-режима, playerChosenIndex хранится в самом вопросе
                    // Для мультиплеера, сервер должен прислать chosenOptionText или мы должны его как-то определить
                    const chosenText = q.chosenOptionText || (typeof q.playerChosenIndex === 'number' && q.playerChosenIndex !== -1 && q.options[q.playerChosenIndex]) || "Пропущено";
                    li.innerHTML = `<strong>Пит:</strong> ${q.questionText}<br>
                                    <span class="user-answer">Ви: ${chosenText}</span><br>
                                    <span class="correct-answer-info">Вірно: ${q.correctOptionText || q.options[q.correctIndex]}</span>`;
                    domElements.mistakesListEl.appendChild(li);
                });
            } else {
                domElements.mistakesContainerEl.style.display = 'none';
            }
        }

        // --- Result Modal & Reset ---
        function showResultModal(resultsDataArray, playerSpecificMistakes = []) { /* ... (добавлено отображение уровня) ... */ 
            clearInterval(questionTimerInterval); clearInterval(matchTimerInterval);
            domElements.resultModalTitleEl.textContent = "Результати Раунду";
            screens.match.classList.remove('active');
            screens.resultModal.style.display = 'flex';

            domElements.resultTableBodyEl.innerHTML = '';
            resultsDataArray.forEach(playerResult => {
                const row = domElements.resultTableBodyEl.insertRow();
                const playerLevel = playerResult.level || getPlayerLevelDetails(playerResult.score).number; // Уровень приходит от сервера или считаем
                const levelName = LEVEL_NAMES[playerLevel-1] || "Новачок";
                row.insertCell().textContent = playerResult.nickname + (playerResult.playerId === localPlayer.id ? " (Ви)" : "");
                row.insertCell().textContent = playerResult.score;
                row.insertCell().textContent = playerResult.correctCount;
                row.insertCell().textContent = playerResult.wrongCount;
                row.insertCell().textContent = `${playerLevel} (${levelName})`;
            });
            
            displayMistakes(playerSpecificMistakes); // Отображаем ошибки для локального игрока
            domElements.rematchBtn.textContent = "Реванш";
        }

        function resetRoomState() { // Сброс состояния текущей комнаты на клиенте
            currentRoom = { id: null, name: "", settings: {lives:3, questionsPerRound:10, topic:'all_ukraine_history', mode:'basic'}, players: [] };
            opponentPlayer = null;
            selectedRoomToJoinId = null;
            domElements.waitingRoomIdDisplay.textContent = '';
            domElements.waitingPlayersListEl.innerHTML = '';
            domElements.waitingStatusTextEl.textContent = 'Очікуємо другого гравця...';
            domElements.joinSelectedRoomForm.style.display = 'none';
            if (domElements.createRoomPasswordInput) domElements.createRoomPasswordInput.value = '';
            if (domElements.createRoomNameInput) domElements.createRoomNameInput.value = '';
            if (domElements.joinRoomPasswordInput) domElements.joinRoomPasswordInput.value = '';
        }

        function resetGameToLobby(optionalMessage = "Ви повернулись в лоббі.") { /* ... (добавлен вызов resetRoomState) ... */ 
            resetRoomState(); // Сбрасываем состояние комнаты
            currentMatch = { questions: [], currentQuestionIndex: -1, totalQuestionsInMatch: 0, isSolo: false, currentQuestionData: null };
            localPlayer.score = 0;
            // localPlayer.lives - не сбрасываем здесь, а при старте новой игры
            localPlayer.isHost = false;
            localPlayer.answeredThisQuestion = false;
            
            clearInterval(questionTimerInterval); clearInterval(matchTimerInterval); clearInterval(countdownInterval);
            clearTimeout(waitingTimeout);
            
            screens.resultModal.style.display = 'none';
            screens.match.classList.remove('active');
            screens.waiting.classList.remove('active');
            screens.createRoom.classList.remove('active');
            screens.joinRoom.classList.remove('active');
            screens.soloSettings.classList.remove('active');
            switchScreen('lobby');

            if(optionalMessage) showStatus(optionalMessage, "info");
        }

        // --- Event Listeners Setup ---
        function setupEventListeners() { /* ... (добавлен refreshRoomListBtn) ... */ 
            // Profile
            domElements.profileBtn.addEventListener('click', () => domElements.profileDropdown.classList.toggle('active'));
            domElements.logoutBtn.addEventListener('click', () => {
                if(ws && ws.readyState === WebSocket.OPEN) ws.close();
                localStorage.removeItem('blitzDatesUserProfile'); 
                localPlayer.nickname = "Гість";
                localPlayer.stats = { totalScore: 0, level: 1, roundsPlayed: 0, wins:0, correctAnswersSum: 0, totalQuestionsAnsweredSum: 0, matchHistory: [] };
                mainNicknameInput.value = "";
                updateProfileUI();
                domElements.profileDropdown.classList.remove('active');
                resetGameToLobby("Ви вийшли. Введіть новий нікнейм.");
                switchScreen('nickname');
            });
            document.addEventListener('click', (event) => { if (!domElements.profileBtn.contains(event.target) && !domElements.profileDropdown.contains(event.target) && domElements.profileDropdown.classList.contains('active')) { domElements.profileDropdown.classList.remove('active'); }});

            // Nickname Screen
            domElements.continueToLobbyBtn.addEventListener('click', () => { /* ... */ });
            domElements.wsAddressInputGlobal.addEventListener('change', () => { /* ... */ });

            // Lobby Screen
            domElements.showCreateRoomScreenBtn.addEventListener('click', () => switchScreen('createRoom'));
            domElements.showJoinRoomScreenBtn.addEventListener('click', () => {
                switchScreen('joinRoom');
                if (ws && ws.readyState === WebSocket.OPEN) { sendToServer({ type: 'get_room_list' }); domElements.roomListContainer.innerHTML = '<p>Завантаження списку кімнат...</p>'; } 
                else { domElements.roomListContainer.innerHTML = '<p>Немає з\'єднання з сервером для отримання списку кімнат. <button id="retryConnectForRoomList">Спробувати підключитись</button></p>'; 
                    document.getElementById('retryConnectForRoomList')?.addEventListener('click', connectWebSocket);
                }
                domElements.joinSelectedRoomForm.style.display = 'none'; 
            });
             domElements.refreshRoomListBtn?.addEventListener('click', () => { // Кнопка обновления списка комнат
                if (ws && ws.readyState === WebSocket.OPEN) { sendToServer({ type: 'get_room_list' }); domElements.roomListContainer.innerHTML = '<p>Оновлення списку кімнат...</p>'; } 
                else { showStatus("Немає з'єднання для оновлення списку.", "error"); }
            });
            domElements.startSoloGameBtn.addEventListener('click', () => switchScreen('soloSettings'));

            // Create Room
            domElements.submitCreateRoomBtn.addEventListener('click', () => {
                if (!localPlayer.nickname || localPlayer.nickname === "Гість") { showStatus("Введіть нікнейм.", "error"); switchScreen('nickname'); return; }
                if (!connectWebSocket()) { showStatus("Не вдалося підключитися до сервера.", "error"); return; }

                const roomName = domElements.createRoomNameInput.value.trim();
                if (!roomName) { showStatus("Назва кімнати обов'язкова!", "error"); return; }
                
                sendToServer({
                    type: 'create_room', nickname: localPlayer.nickname, roomName: roomName,
                    password: domElements.createRoomPasswordInput.value, 
                    topic: domElements.createRoomTopicSelect.value,
                    mode: domElements.createGameModeSelect.value,
                    lives: parseInt(domElements.createLivesCountSelect.value),
                    questionsPerRound: parseInt(domElements.createQuestionsCountInput.value) || 10
                });
            });

            // Join Room
            domElements.submitJoinRoomBtn.addEventListener('click', () => { /* ... */ });
            
            // Solo Settings
            domElements.submitStartSoloGameBtn.addEventListener('click', startSoloGame);

            // Waiting Screen
            domElements.cancelWaitingBtn.addEventListener('click', () => { /* ... */ });

            // Match Screen
            domElements.leaveMatchBtn.addEventListener('click', () => { /* ... */ });

            // Result Modal
            domElements.rematchBtn.addEventListener('click', () => { /* ... */ });
            domElements.exitToLobbyFromModalBtn.addEventListener('click', () => { /* ... */ });
        }
        
        // --- Копия данных для соло-режима и генерации тем (чтобы не загромождать ALL_HISTORICAL_EVENTS_SERVER)
        const ALL_HISTORICAL_EVENTS = [
    // Стародавня історія України
    { topic_key: "ancient_ukraine", topic_readable: "Стародавня історія України", date: "IV- середина III тис. до н.е.", event: "розселення племен трипільської та середньостогівської культур", brief: "Трипільська культура відома своєю керамікою та великими поселеннями, середньостогівська – початком одомашнення коня." },
    { topic_key: "ancient_ukraine", topic_readable: "Стародавня історія України", date: "VIII-VI ст. до н.е.", event: "Велика грецька колонізація", brief: "Грецькі міста-колонії (Ольвія, Пантікапей, Херсонес) виникли на узбережжі Чорного та Азовського морів, впливаючи на місцеві культури." },
    { topic_key: "ancient_ukraine", topic_readable: "Стародавня історія України", date: "V-VII ст.", event: "Велике розселення слов'ян", brief: "Слов'янські племена (анти, склавини) розселилися на значній території Східної Європи, закладаючи основи майбутніх народів." },

    // Русь-Україна
    { topic_key: "rus_ukraine", topic_readable: "Русь-Україна", date: "860 р.", event: "похід Аскольда на Константинополь, укладення першого відомого договору Русі з Візантією", brief: "Перший зафіксований морський похід русів на столицю Візантії, що свідчив про зростання військово-політичної потуги Русі." },
    { topic_key: "rus_ukraine", topic_readable: "Русь-Україна", date: "907, 911, 941, 944 рр.", event: "походи князів на Константинополь", brief: "Серія військових походів руських князів (Олега, Ігоря) на Візантію, що завершилися укладенням вигідних торговельних угод." },
    { topic_key: "rus_ukraine", topic_readable: "Русь-Україна", date: "882 р.", event: "об'єднання північних та південних руських земель Олегом", brief: "Князь Олег захопив Київ, убивши Аскольда і Діра, та проголосив його 'матір'ю міст руських', об'єднавши землі вздовж шляху 'з варяг у греки'." },
    { topic_key: "rus_ukraine", topic_readable: "Русь-Україна", date: "988 р.", event: "запровадження християнства як державної релігії", brief: "Князь Володимир Великий охрестив Русь, прийнявши християнство візантійського обряду, що мало величезний вплив на культуру та політику." },
    { topic_key: "rus_ukraine", topic_readable: "Русь-Україна", date: "1019-1054 pp.", event: "князювання Ярослава Мудрого в м. Київ", brief: "Період найвищого розквіту Київської Русі, створення 'Руської Правди', будівництво Софійського собору, розвиток освіти." },
    { topic_key: "rus_ukraine", topic_readable: "Русь-Україна", date: "1036 р.", event: "розгром печенігів князем Ярославом Мудрим", brief: "Вирішальна перемога над кочовими племенами печенігів під Києвом, яка забезпечила мир на південних кордонах Русі." },
    { topic_key: "rus_ukraine", topic_readable: "Русь-Україна", date: "1097 р.", event: "Любецький з'їзд (снем) князів", brief: "З'їзд руських князів у Любечі з метою припинення міжусобиць; проголошено принцип 'кождо да держить отчину свою', що закріпив феодальну роздробленість." },
    { topic_key: "rus_ukraine", topic_readable: "Русь-Україна", date: "1113 р.", event: "укладення «Повісті минулих літ»; початок правління Володимира Мономаха в м. Київ", brief: "Нестор Літописець (або Сильвестр) завершив першу редакцію літопису; Володимир Мономах, відомий своїми походами проти половців та 'Повчанням дітям', став великим князем київським." },
    { topic_key: "rus_ukraine", topic_readable: "Русь-Україна", date: "1187 р.", event: "перша згадка назви «Україна» в писемних джерелах, створення «Слова о полку Ігоревім»", brief: "Назва 'Україна' (окраїна, прикордоння) вперше згадана в Київському літописі щодо Переяславщини; 'Слово о полку Ігоревім' - видатна пам'ятка давньоруської літератури." },

    // Королівство Руське (Галицько-Волинська держава). Монгольська навала
    { topic_key: "galicia_volhynia_mongol", topic_readable: "Королівство Руське (Галицько-Волинська держава). Монгольська навала", date: "1199 р.", event: "утворення Галицько-Волинської держави", brief: "Волинський князь Роман Мстиславич об'єднав Галицьке та Волинське князівства в єдину сильну державу." },
    { topic_key: "galicia_volhynia_mongol", topic_readable: "Королівство Руське (Галицько-Волинська держава). Монгольська навала", date: "1223 р.", event: "битва біля р. Калка", brief: "Перше трагічне зіткнення руських та половецьких військ з монголами, що завершилося нищівною поразкою союзників." },
    { topic_key: "galicia_volhynia_mongol", topic_readable: "Королівство Руське (Галицько-Волинська держава). Монгольська навала", date: "1238 - 1264 pp.", event: "правління Данила Романовича", brief: "Видатний правитель Галицько-Волинської держави, який вів боротьбу проти монгольського панування, заснував міста Львів та Холм." },
    { topic_key: "galicia_volhynia_mongol", topic_readable: "Королівство Руське (Галицько-Воlinська держава). Монгольська навала", date: "1240 р.", event: "захоплення м. Київ монголами", brief: "Монгольські війська під проводом хана Батия після тривалої облоги захопили та зруйнували Київ." },
    { topic_key: "galicia_volhynia_mongol", topic_readable: "Королівство Руське (Галицько-Волинська держава). Монгольська навала", date: "1245 р.", event: "битва біля м. Ярослав; поїздка Данила Романовича в Золоту Орду", brief: "Данило Галицький розгромив об'єднані сили угорських, польських та галицьких бояр; змушений був визнати зверхність Золотої Орди для збереження держави." },
    { topic_key: "galicia_volhynia_mongol", topic_readable: "Королівство Руське (Галицько-Волинська держава). Монгольська навала", date: "1253 р.", event: "коронування Данила Романовича", brief: "Данило Галицький прийняв королівську корону від Папи Римського Інокентія IV, сподіваючись на допомогу Заходу в боротьбі проти монголів." },

    // Руські удільні клязівства у складі іноземних держав у другій половині XIV - першій половині XVI ст. Кримське ханство
    { topic_key: "rus_principalities_foreign_rule_crimean_khanate", topic_readable: "Руські удільні клязівства у складі іноземних держав у другій половині XIV - першій половині XVI ст. Кримське ханство", date: "1362 р.", event: "битва біля р. Сині Води", brief: "Литовсько-руське військо на чолі з князем Ольгердом розгромило татар, звільнивши значну частину українських земель від ординського панування." },
    { topic_key: "rus_principalities_foreign_rule_crimean_khanate", topic_readable: "Руські удільні клязівства у складі іноземних держав у другій половині XIV - першій половині XVI ст. Кримське ханство", date: "1385 р.", event: "укладення Кревської унії", brief: "Угода між Великим князівством Литовським і Польським королівством, що передбачала шлюб литовського князя Ягайла з польською королевою Ядвігою та об'єднання держав." },
    { topic_key: "rus_principalities_foreign_rule_crimean_khanate", topic_readable: "Руські удільні клязівства у складі іноземних держав у другій половині XIV - першій половині XVI ст. Кримське ханство", date: "40-і рр. XV ст.", event: "утворення Кримського ханства", brief: "На уламках Золотої Орди виникла нова держава — Кримське ханство на чолі з династією Гіреїв." },
    { topic_key: "rus_principalities_foreign_rule_crimean_khanate", topic_readable: "Руські удільні клязівства у складі іноземних держав у другій половині XIV - першій половині XVI ст. Кримське ханство", date: "1478 р.", event: "визнання Кримським ханством васальної залежності від Османської імперії", brief: "Кримське ханство стало васалом могутньої Османської імперії, що посилило його військову потугу та агресивність." },
    { topic_key: "rus_principalities_foreign_rule_crimean_khanate", topic_readable: "Руські удільні клязівства у складі іноземних держав у другій половині XIV - першій половині XVI ст. Кримське ханство", date: "1489 р.", event: "перша згадка про козаків у літописних джерелах", brief: "Польський хроніст Марцін Бєльський вперше згадує козаків у зв'язку з їхніми походами проти татар." },
    { topic_key: "rus_principalities_foreign_rule_crimean_khanate", topic_readable: "Руські удільні клязівства у складі іноземних держав у другій половині XIV - першій половині XVI ст. Кримське ханство", date: "1514 р.", event: "битва під Оршею, розгром війська московитів", brief: "Об'єднане польсько-литовсько-руське військо під командуванням Костянтина Острозького завдало поразки московським військам." },

    // Українські землі у складі Речі Посполитої в другій половині XVI ст.
    { topic_key: "ukrainian_lands_commonwealth_16c", topic_readable: "Українські землі у складі Речі Посполитої в другій половині XVI ст.", date: "1556 — 1561 р.", event: "створення Пересопницького Євангелія", brief: "Визначна рукописна пам'ятка, переклад Євангелія староукраїнською мовою, на якому присягають президенти України." },
    { topic_key: "ukrainian_lands_commonwealth_16c", topic_readable: "Українські землі у складі Речі Посполитої в другій половині XVI ст.", date: "1556 р.", event: "заснування князем Д. Вишневецьким на о. Мала Хортиця першої Січі", brief: "Дмитро Вишневецький ('Байда') збудував укріплення на острові Мала Хортиця, яке вважається прототипом Запорозької Січі." },
    { topic_key: "ukrainian_lands_commonwealth_16c", topic_readable: "Українські землі у складі Речі Посполитої в другій половині XVI ст.", date: "1569 р.", event: "Люблінська унія; утворення Речі Посполитої", brief: "Об'єднання Польського королівства та Великого князівства Литовського в єдину державу — Річ Посполиту; українські землі перейшли під владу Польщі." },
    { topic_key: "ukrainian_lands_commonwealth_16c", topic_readable: "Українські землі у складі Речі Посполитої в другій половині XVI ст.", date: "1586 р.", event: "утворення першої братської (слов'яно-греко-латинської) школи у м. Львів", brief: "Львівське Успенське братство заснувало школу, що стала важливим осередком православної освіти та культури, протидіючи полонізації." },
    { topic_key: "ukrainian_lands_commonwealth_16c", topic_readable: "Українські землі у складі Речі Посполитої в другій половині XVI ст.", date: "1596 р.", event: "Берестейська унія; утворення УГКЦ", brief: "На церковному соборі в Бересті частина православних ієрархів визнала зверхність Папи Римського, утворивши Українську Греко-Католицьку Церкву." },

    // Українські землі у складі Речі Посполитої в першій половині XVII ст.
    { topic_key: "ukrainian_lands_commonwealth_17c", topic_readable: "Українські землі у складі Речі Посполитої в першій половині XVII ст.", date: "1618 р.", event: "похід козаків під проводом гетьмана П. Конашевича-Сагайдачного на москву", brief: "Козацьке військо на чолі з Сагайдачним взяло участь у поході польського королевича Владислава на Москву, продемонструвавши свою військову силу." },
    { topic_key: "ukrainian_lands_commonwealth_17c", topic_readable: "Українські землі у складі Речі Посполитої в першій половині XVII ст.", date: "1621 р.", event: "Хотинська битва", brief: "Козацько-польське військо під Хотином завдало поразки турецько-татарській армії, зупинивши її просування в Європу; вирішальну роль відіграли козаки Сагайдачного." },
    { topic_key: "ukrainian_lands_commonwealth_17c", topic_readable: "Українські землі у складі Речі Посполитої в першій половині XVII ст.", date: "1625 р.", event: "Куруківська угода", brief: "Угода між козацькою старшиною та польським урядом після повстання Марка Жмайла, що збільшувала козацький реєстр до 6 тисяч." },
    { topic_key: "ukrainian_lands_commonwealth_17c", topic_readable: "Українські землі у складі Речі Посполитої в першій половині XVII ст.", date: "1632 р.", event: "\"Пункти для заспокоєння руського народу\", утворення Київської колегії", brief: "Король Владислав IV видав 'Пункти...', що легалізували православну церкву; Петро Могила заснував Києво-Могилянську колегію, важливий освітньо-культурний центр." },
    { topic_key: "ukrainian_lands_commonwealth_17c", topic_readable: "Українські землі у складі Речі Посполитої в першій половині XVII ст.", date: "1637 - 1638 pp.", event: "повстання під проводом Павла Павлюка, Якова Острянина, Дмитра Гуні", brief: "Низка великих козацько-селянських повстань проти польського панування, жорстоко придушених, що призвели до 'Ординації Війська Запорозького'." },

    // Національно-визвольна війна українського народу під проводом Б. Хмельницького
    { topic_key: "khmelnytsky_uprising", topic_readable: "Національно-визвольна війна українського народу під проводом Б. Хмельницького", date: "1648 р.", event: "Жовтоводська, Корсунська та Пилявецька битви", brief: "Перші переможні битви козацького війська під проводом Богдана Хмельницького над польською шляхтою, що поклали початок Визвольній війні." },
    { topic_key: "khmelnytsky_uprising", topic_readable: "Національно-визвольна війна українського народу під проводом Б. Хмельницького", date: "1649 р.", event: "Зборівська битва, Зборівський договір", brief: "Битва під Зборовом та укладений договір, що визнавав автономію Гетьманщини у складі трьох воєводств та 40-тисячний козацький реєстр." },
    { topic_key: "khmelnytsky_uprising", topic_readable: "Національно-визвольна війна українського народу під проводом Б. Хмельницького", date: "1651 р.", event: "Берестецька битва, Білоцерківський договір", brief: "Трагічна поразка козацького війська під Берестечком через зраду кримського хана; укладено невигідний Білоцерківський договір, що обмежував автономію." },
    { topic_key: "khmelnytsky_uprising", topic_readable: "Національно-визвольна війна українського народу під проводом Б. Хмельницького", date: "1652 р.", event: "Батозька битва", brief: "Блискуча перемога козацького війська над поляками під Батогом, що відновила умови Зборівського договору та звільнила значну територію." },
    { topic_key: "khmelnytsky_uprising", topic_readable: "Національно-визвольна війна українського народу під проводом Б. Хмельницького", date: "1653 р.", event: "Жванецька облога, Кам'янецький договір", brief: "Облога польського війська під Жванцем; татари знову зрадили Хмельницького, уклавши сепаратний Кам'янецький договір з поляками." },
    { topic_key: "khmelnytsky_uprising", topic_readable: "Національно-визвольна війна українського народу під проводом Б. Хмельницького", date: "1654 р.", event: "Переяславська рада, \"Березневі статті\"", brief: "Козацька рада в Переяславі ухвалила рішення про військово-політичний союз із Московським царством; 'Березневі статті' визначали умови цього союзу." },
    { topic_key: "khmelnytsky_uprising", topic_readable: "Національно-визвольна війна українського народу під проводом Б. Хмельницького", date: "1656 р.", event: "московсько-польське Віленське перемир'я", brief: "Московське царство уклало перемир'я з Річчю Посполитою у Вільно, ігноруючи інтереси Гетьманщини, що стало ударом для Б. Хмельницького." },

    // Козацька Україна наприкінці 50-80-х рр. XVII ст.
    { topic_key: "cossack_ukraine_late_17c", topic_readable: "Козацька Україна наприкінці 50-80-х рр. XVII ст.", date: "1658 р.", event: "Гадяцький договір", brief: "Угода між Гетьманщиною (І. Виговський) та Річчю Посполитою про входження Великого Князівства Руського як третього рівноправного члена федерації." },
    { topic_key: "cossack_ukraine_late_17c", topic_readable: "Козацька Україна наприкінці 50-80-х рр. XVII ст.", date: "1659 р.", event: "Конотопська битва", brief: "Блискуча перемога українсько-татарського війська під проводом Івана Виговського над московською армією під Конотопом." },
    { topic_key: "cossack_ukraine_late_17c", topic_readable: "Козацька Україна наприкінці 50-80-х рр. XVII ст.", date: "1667 р.", event: "Андрусівське перемир'я", brief: "Перемир'я між Московським царством та Річчю Посполитою, що розділило Україну по Дніпру: Лівобережжя відійшло Москві, Правобережжя – Польщі." },
    { topic_key: "cossack_ukraine_late_17c", topic_readable: "Козацька Україна наприкінці 50-80-х рр. XVII ст.", date: "1669 р.", event: "Корсунська угода, визнання Правобережною Гетьманщиною протекторату Османської імперії", brief: "Гетьман Правобережної України Петро Дорошенко уклав угоду про протекторат Османської імперії над Правобережною Гетьманщиною." },
    { topic_key: "cossack_ukraine_late_17c", topic_readable: "Козацька Україна наприкінці 50-80-х рр. XVII ст.", date: "1681 р.", event: "Бахчисарайський мирний договір", brief: "Договір між Московським царством та Османською імперією, що закріпив поділ України по Дніпру та встановив кордон між державами." },
    { topic_key: "cossack_ukraine_late_17c", topic_readable: "Козацька Україна наприкінці 50-80-х рр. XVII ст.", date: "1686 р.", event: "\"Вічний мир\" між московським царством і Річчю Посполитою, підпорядкування Київської митрополії московському патріархатові", brief: "Договір, що остаточно закріпив поділ України між Москвою та Польщею; Київська митрополія перейшла під юрисдикцію Московського патріархату." },

    // Українські землі наприкінці XVII — в першій пол. XVIII ст.
    { topic_key: "ukrainian_lands_late_17c_early_18c", topic_readable: "Українські землі наприкінці XVII — в першій пол. XVIII ст.", date: "1708 р.", event: "українсько-шведський союз, зруйнування Батурина", brief: "Гетьман Іван Мазепа уклав союз зі шведським королем Карлом XII проти Московського царства; російські війська жорстоко знищили гетьманську столицю Батурин." },
    { topic_key: "ukrainian_lands_late_17c_early_18c", topic_readable: "Українські землі наприкінці XVII — в першій пол. XVIII ст.", date: "1709 р.", event: "зруйнування російськими військами Чортомлицької Січі; Полтавська битва", brief: "Російські війська зруйнували Чортомлицьку Січ за підтримку Мазепи; вирішальна битва Північної війни, в якій шведсько-українські війська зазнали поразки." },
    { topic_key: "ukrainian_lands_late_17c_early_18c", topic_readable: "Українські землі наприкінці XVII — в першій пол. XVIII ст.", date: "1710 р.", event: "Конституція Пилипа Орлика", brief: "«Пакти й Конституції прав і вольностей Війська Запорозького» – договір між гетьманом П. Орликом та козацькою старшиною, що вважається однією з перших конституцій у світі." },
    { topic_key: "ukrainian_lands_late_17c_early_18c", topic_readable: "Українські землі наприкінці XVII — в першій пол. XVIII ст.", date: "1713 р.", event: "ліквідація козацтва на Правобережній Україні", brief: "Польський сейм ухвалив рішення про остаточну ліквідацію козацького устрою на Правобережній Україні." },
    { topic_key: "ukrainian_lands_late_17c_early_18c", topic_readable: "Українські землі наприкінці XVII — в першій пол. XVIII ст.", date: "1734 р.", event: "заснування Нової (Підпільненської) Січі", brief: "Після повернення запорожців з-під турецької влади, вони заснували нову Січ на річці Підпільній, яка стала останнім оплотом козацької вольниці." },

    // Українські землі в другій половині XVIII ст.
    { topic_key: "ukrainian_lands_late_18c", topic_readable: "Українські землі в другій половині XVIII ст.", date: "1764 р.", event: "остаточна ліквідація гетьманства", brief: "Російська імператриця Катерина II скасувала посаду гетьмана, призначивши замість неї Другу Малоросійську колегію на чолі з П. Рум'янцевим." },
    { topic_key: "ukrainian_lands_late_18c", topic_readable: "Українські землі в другій половині XVIII ст.", date: "1768 р.", event: "Коліївщина", brief: "Велике гайдамацьке повстання на Правобережній Україні проти польського гніту, очолене Максимом Залізняком та Іваном Гонтою." },
    { topic_key: "ukrainian_lands_late_18c", topic_readable: "Українські землі в другій половині XVIII ст.", date: "1775 р.", event: "остаточна ліквідація Запорозької Січі", brief: "За наказом Катерини II російські війська зруйнували Підпільненську (Нову) Січ, поклавши край існуванню Запорозької Січі." },
    { topic_key: "ukrainian_lands_late_18c", topic_readable: "Українські землі в другій половині XVIII ст.", date: "1780 — 1782 pp.", event: "ліквідація особистої залежності селян в Австрійській імперії", brief: "В рамках реформ Марії-Терезії та Йосифа ІІ в Австрійській імперії було скасовано особисту залежність селян, що полегшило їхнє становище." },
    { topic_key: "ukrainian_lands_late_18c", topic_readable: "Українські землі в другій половині XVIII ст.", date: "1783 р.", event: "закріпачення селян Лівобережної та Слобідської України", brief: "Указом Катерини II на Лівобережжі та Слобожанщині було запроваджено кріпосне право, зрівнявши українських селян у правах з російськими." },
    { topic_key: "ukrainian_lands_late_18c", topic_readable: "Українські землі в другій половині XVIII ст.", date: "1783 р.", event: "підкорення російською імперією Кримського ханства", brief: "Російська імперія анексувала Кримське ханство, поклавши край його існуванню та розширивши свої володіння на півдні." },

    // Українські землі у складі російської імперії наприкінці XVIII — у першій половині XIX ст.
    { topic_key: "ukraine_russian_empire_late_18c_early_19c", topic_readable: "Українські землі у складі російської імперії наприкінці XVIII — у першій половині XIX ст.", date: "1798 р.", event: "вихід друком \"Енеїди\" Івана Котляревського", brief: "Перший твір нової української літератури, написаний народною мовою, що започаткував новий етап у розвитку української культури." },
    { topic_key: "ukraine_russian_empire_late_18c_early_19c", topic_readable: "Українські землі у складі російської імперії наприкінці XVIII — у першій половині XIX ст.", date: "грудень 1825 — січень 1826 pp.", event: "повстання Чернігівського полку", brief: "Збройний виступ Чернігівського полку, організований членами Південного товариства декабристів, з метою повалення самодержавства." },
    { topic_key: "ukraine_russian_empire_late_18c_early_19c", topic_readable: "Українські землі у складі російської імперії наприкінці XVIII — у першій половині XIX ст.", date: "1828 р.", event: "ліквідація Задунайської Січі", brief: "За наказом турецького султана було ліквідовано Задунайську Січ після переходу частини козаків на бік Росії під час російсько-турецької війни." },
    { topic_key: "ukraine_russian_empire_late_18c_early_19c", topic_readable: "Українські землі у складі російської імперії наприкінці XVIII — у першій половині XIX ст.", date: "1830 — 1831 pp.", event: "польське визвольне повстання", brief: "Повстання проти російського панування, що охопило польські та частково правобережні українські землі; було жорстоко придушене." },
    { topic_key: "ukraine_russian_empire_late_18c_early_19c", topic_readable: "Українські землі у складі російської імперії наприкінці XVIII — у першій половині XIX ст.", date: "1840 р.", event: "перше видання \"Кобзаря\" Т. Шевченка", brief: "Вихід у світ збірки поезій Тараса Шевченка, що мала величезне значення для становлення української національної свідомості та літератури." },
    { topic_key: "ukraine_russian_empire_late_18c_early_19c", topic_readable: "Українські землі у складі російської імперії наприкінці XVIII — у першій половині XIX ст.", date: "1846-1847 pp.", event: "діяльність Кирило-Мефодіївського братства", brief: "Таємна політична організація української інтелігенції в Києві, що ставила за мету створення слов'янської федерації з центром в Україні." },

    // Українські землі у складі Австрійської імперії наприкінці XVIII — в першій пол. XIX ст.
    { topic_key: "ukraine_austrian_empire_late_18c_early_19c", topic_readable: "Українські землі у складі Австрійської імперії наприкінці XVIII — в першій пол. XIX ст.", date: "1816 pp.", event: "створення освітнього товариства галицьких греко-католицьких священиків", brief: "У Перемишлі засновано товариство з метою поширення освіти та релігійної літератури українською мовою." },
    { topic_key: "ukraine_austrian_empire_late_18c_early_19c", topic_readable: "Українські землі у складі Австрійської імперії наприкінці XVIII — в першій пол. XIX ст.", date: "1833-1837 pp.", event: "діяльність \"Руської трійці\"", brief: "Літературне угруповання (М. Шашкевич, І. Вагилевич, Я. Головацький) у Галичині, що започаткувало національно-культурне відродження, видавши альманах 'Русалка Дністровая'." },
    { topic_key: "ukraine_austrian_empire_late_18c_early_19c", topic_readable: "Українські землі у складі Австрійської імперії наприкінці XVIII — в першій пол. XIX ст.", date: "1837 р.", event: "видання \"Русалки Дністрової\"", brief: "Альманах, виданий 'Руською трійцею' народною українською мовою, що став маніфестом українського національного відродження в Галичині." },
    { topic_key: "ukraine_austrian_empire_late_18c_early_19c", topic_readable: "Українські землі у складі Австрійської імперії наприкінці XVIII — в першій пол. XIX ст.", date: "1848 р.", event: "скасування панщини в Галичині, створення Головної Руської Ради, видання першої українськомовної газети «Зоря Галицька»", brief: "Під час 'Весни народів' в Австрійській імперії було скасовано панщину, створено першу українську політичну організацію та розпочато видання газети українською мовою." },

    // Культура України кінця XVIII – першої половини XIX ст.
    { topic_key: "ukrainian_culture_late_18c_early_19c", topic_readable: "Культура України кінця XVIII – першої половини XIX ст.", date: "1805 р.", event: "відкриття університету в Харкові", brief: "За ініціативи В. Каразіна засновано Харківський університет, який став важливим центром освіти і науки на Лівобережній Україні." },
    { topic_key: "ukrainian_culture_late_18c_early_19c", topic_readable: "Культура України кінця XVIII – першої половини XIX ст.", date: "1834 р.", event: "відкриття університету в Києві", brief: "Засновано Київський університет Святого Володимира, що відіграв значну роль у розвитку української культури та науки." },
    { topic_key: "ukrainian_culture_late_18c_early_19c", topic_readable: "Культура України кінця XVIII – першої половини XIX ст.", date: "1839 р.", event: "ліквідація царською владою греко-католицької церкви на Правобережжі", brief: "Російський уряд ліквідував греко-католицьку церкву на Правобережній Україні, насильно приєднавши її вірних до Російської православної церкви." },

    // Українські землі у складі російської імперії в другій половині XIX ст.
    { topic_key: "ukraine_russian_empire_late_19c", topic_readable: "Українські землі у складі російської імперії в другій половині XIX ст.", date: "19 лютого 1861 р.", event: "царський маніфест про скасування кріпосного права в російській імперії", brief: "Імператор Олександр II видав маніфест, що скасовував кріпосне право, надаючи селянам особисту свободу та землю за викуп." },
    { topic_key: "ukraine_russian_empire_late_19c", topic_readable: "Українські землі у складі російської імперії в другій половині XIX ст.", date: "1863 р.", event: "Валуєвський циркуляр", brief: "Таємне розпорядження міністра внутрішніх справ П. Валуєва, що забороняло друкування книг українською мовою, окрім художньої літератури." },
    { topic_key: "ukraine_russian_empire_late_19c", topic_readable: "Українські землі у складі російської імперії в другій половині XIX ст.", date: "1863-1864 pp.", event: "польське національно-визвольне повстання", brief: "Повстання проти російського панування, яке охопило польські, литовські, білоруські та частково українські землі; було придушене." },
    { topic_key: "ukraine_russian_empire_late_19c", topic_readable: "Українські землі у складі російської імперії в другій половині XIX ст.", date: "1876 р.", event: "Емський указ", brief: "Указ Олександра II, що забороняв друкування книг українською мовою, ввезення їх з-за кордону, сценічні вистави та викладання українською мовою." },

    // Українські землі у складі Австро-Угорщини в другій пол. XIX ст.
    { topic_key: "ukraine_austro_hungary_late_19c", topic_readable: "Українські землі у складі Австро-Угорщини в другій пол. XIX ст.", date: "1868 р.", event: "створення у Львові товариства \"Просвіта\"", brief: "Культурно-освітня організація, заснована народовцями з метою поширення освіти та національної свідомості серед українського населення Галичини." },
    { topic_key: "ukraine_austro_hungary_late_19c", topic_readable: "Українські землі у складі Австро-Угорщини в другій пол. XIX ст.", date: "1873 р.", event: "створення у Львові Літературного товариства ім. Т. Шевченка (від 1892 р. - Наукового товариства ім. Т. Шевченка)", brief: "Наукова установа, що стала центром української науки та культури, фактично виконуючи функції української академії наук." },
    { topic_key: "ukraine_austro_hungary_late_19c", topic_readable: "Українські землі у складі Австро-Угорщини в другій пол. XIX ст.", date: "1890 р.", event: "створення Русько-української радикальної партії (РУРП)", brief: "Перша українська політична партія європейського типу, заснована І. Франком, М. Павликом та ін., що висунула ідею політичної самостійності України." },
    { topic_key: "ukraine_austro_hungary_late_19c", topic_readable: "Українські землі у складі Австро-Угорщини в другій пол. XIX ст.", date: "1899 р.", event: "створення Української Національно-демократичної партії та Української соціал-демократичної партії", brief: "Заснування двох впливових українських політичних партій в Галичині, що відображали різні ідеологічні напрямки національного руху." },

    // Культура України в другій половині XIX – початку XX ст.
    { topic_key: "ukrainian_culture_late_19c_early_20c", topic_readable: "Культура України в другій половині XIX – початку XX ст.", date: "1865 р.", event: "відкриття Новоросійського університету", brief: "В Одесі засновано Новоросійський університет (нині Одеський національний університет імені І. І. Мечникова), важливий науковий центр." },
    { topic_key: "ukrainian_culture_late_19c_early_20c", topic_readable: "Культура України в другій половині XIX – початку XX ст.", date: "1875 р.", event: "відкриття Чернівецького університету", brief: "Засновано Чернівецький університет (нині Чернівецький національний університет імені Юрія Федьковича), центр освіти і науки на Буковині." },

    // Українські землі у складі російської імперії в 1900 – 1914 рр.
    { topic_key: "ukraine_russian_empire_1900_1914", topic_readable: "Українські землі у складі російської імперії в 1900 – 1914 рр.", date: "1900 р.", event: "утворення Революційної української партії (РУП)", brief: "Перша українська політична партія в Наддніпрянській Україні, що висунула гасло самостійної України (автор програми М. Міхновський)." },
    { topic_key: "ukraine_russian_empire_1900_1914", topic_readable: "Українські землі у складі російської імперії в 1900 – 1914 рр.", date: "1905 р.", event: "створення першої в Наддіпрянській Україні \"Просвіти\"", brief: "Після революції 1905 року в Наддніпрянщині почали виникати товариства 'Просвіта' за галицьким зразком, сприяючи культурному розвитку." },
    { topic_key: "ukraine_russian_empire_1900_1914", topic_readable: "Українські землі у складі російської імперії в 1900 – 1914 рр.", date: "1908 р.", event: "створення Товариства українських поступовців (ТУП)", brief: "Нелегальна міжпартійна політична організація, що об'єднувала українську інтелігенцію, яка виступала за автономію України." },

    // Українські землі у складі Австро-Угорщини в 1900 – 1914 pp.
    { topic_key: "ukraine_austro_hungary_1900_1914", topic_readable: "Українські землі у складі Австро-Угорщини в 1900 – 1914 pp.", date: "1900 р.", event: "обрання Андрея Шептицького митрополитом УГКЦ", brief: "Андрей Шептицький очолив Українську Греко-Католицьку Церкву, ставши видатним церковним і громадським діячем, меценатом." },
    { topic_key: "ukraine_austro_hungary_1900_1914", topic_readable: "Українські землі у складі Австро-Угорщини в 1900 – 1914 pp.", date: "1907 р.", event: "впровадження в Австро-Угорській імперії загального виборчого права для чоловіків", brief: "Реформа виборчої системи, що надала право голосу всім чоловікам, які досягли 24 років, посиливши представництво українців у парламенті." },

    // Україна в роки Першої світової війни
    { topic_key: "ukraine_ww1", topic_readable: "Україна в роки Першої світової війни", date: "серпень 1914 р.", event: "утворення Головної української ради, формування легіону Українських січових стрільців, створення Союзу визволення України", brief: "Створення політичних та військових організацій (ГУР, УСС, СВУ), що ставили за мету боротьбу за інтереси України в умовах війни." },
    { topic_key: "ukraine_ww1", topic_readable: "Україна в роки Першої світової війни", date: "1914 р.", event: "Галицька битва", brief: "Велика битва на Східному фронті, в результаті якої російські війська окупували Галичину та Буковину." },
    { topic_key: "ukraine_ww1", topic_readable: "Україна в роки Першої світової війни", date: "1915 р.", event: "утворення Загальної української ради", brief: "Політична організація, створена у Відні, що об'єднала представників українських партій Галичини та Буковини для координації дій." },
    { topic_key: "ukraine_ww1", topic_readable: "Україна в роки Першої світової війни", date: "1916 р.", event: "Брусиловський прорив", brief: "Наступальна операція російських військ Південно-Західного фронту під командуванням О. Брусилова, що призвела до значних втрат з обох сторін." },

    // Початок Української революції
    { topic_key: "ukrainian_revolution_beginning", topic_readable: "Початок Української революції", date: "березень 1917 р.", event: "утворення Української Центральної Ради (УЦР)", brief: "У Києві створено представницький орган українських політичних сил на чолі з М. Грушевським, що став центром українського національного руху." },
    { topic_key: "ukrainian_revolution_beginning", topic_readable: "Початок Української революції", date: "квітень 1917 р.", event: "Всеукраїнський Національний конгрес", brief: "З'їзд представників українських організацій, що підтримав УЦР як вищий представницький орган України та обрав її новий склад." },
    { topic_key: "ukrainian_revolution_beginning", topic_readable: "Початок Української революції", date: "червень 1917 р.", event: "І Універсал УЦР", brief: "Проголошення автономії України у складі Росії, заклик до народу самостійно організовувати своє життя на місцях." },
    { topic_key: "ukrainian_revolution_beginning", topic_readable: "Початок Української революції", date: "липень 1917 р.", event: "II Універсал УЦР", brief: "Компромісний документ, що відкладав проголошення автономії до Всеросійських Установчих зборів, викликав невдоволення частини українських політиків." },
    { topic_key: "ukrainian_revolution_beginning", topic_readable: "Початок Української революції", date: "листопад 1917 р.", event: "III Універсал УЦР", brief: "Проголошення Української Народної Республіки (УНР) у федеративному зв'язку з Росією, запровадження демократичних свобод, скасування приватної власності на землю." },
    { topic_key: "ukrainian_revolution_beginning", topic_readable: "Початок Української революції", date: "9 (22) січня 1918 р.", event: "IV Універсал УЦР, проголошення незалежності УНР", brief: "Проголошення повної державної незалежності Української Народної Республіки." },
    { topic_key: "ukrainian_revolution_beginning", topic_readable: "Початок Української революції", date: "січень 1918 р.", event: "бій біля станції Крути", brief: "Героїчний бій українських студентів та юнкерів проти наступаючих більшовицьких військ, символ самопожертви в боротьбі за незалежність." },
    { topic_key: "ukrainian_revolution_beginning", topic_readable: "Початок Української революції", date: "січень (лютий) 1918 р.", event: "Берестейський мирний договір між УНР та державами Четверного союзу", brief: "УНР визнана незалежною державою країнами Четверного союзу (Німеччина, Австро-Угорщина, Туреччина, Болгарія); договір передбачав військову допомогу УНР." },

    // Розгортання Української революції. Боротьба за відновлення незалежності
    { topic_key: "ukrainian_revolution_independence_struggle", topic_readable: "Розгортання Української революції. Боротьба за відновлення незалежності", date: "29 квітня 1918 р.", event: "державний переворот і прихід до влади П. Скоропадського", brief: "За підтримки німецьких військ УЦР було розпущено, проголошено Українську Державу на чолі з гетьманом Павлом Скоропадським." },
    { topic_key: "ukrainian_revolution_independence_struggle", topic_readable: "Розгортання Української революції. Боротьба за відновлення незалежності", date: "1 листопада 1918 р.", event: "\"Листопадовий зрив\" у Львові", brief: "Українські військові захопили владу у Львові та інших містах Галичини, проголосивши утворення української держави." },
    { topic_key: "ukrainian_revolution_independence_struggle", topic_readable: "Розгортання Української революції. Боротьба за відновлення незалежності", date: "13 листопада 1918 р.", event: "проголошення Західноукраїнської Народної Республіки", brief: "Українська Національна Рада проголосила утворення Західноукраїнської Народної Республіки (ЗУНР) на території Галичини, Буковини та Закарпаття." },
    { topic_key: "ukrainian_revolution_independence_struggle", topic_readable: "Розгортання Української революції. Боротьба за відновлення незалежності", date: "листопад 1918 р.", event: "заснування Української академії наук", brief: "За гетьмана П. Скоропадського було засновано Українську академію наук (УАН) на чолі з В. Вернадським." },
    { topic_key: "ukrainian_revolution_independence_struggle", topic_readable: "Розгортання Української революції. Боротьба за відновлення незалежності", date: "14 листопада 1918 р.", event: "утворення Директорії", brief: "Опозиційні до гетьмана сили утворили Директорію на чолі з В. Винниченком для керівництва повстанням проти режиму Скоропадського." },
    { topic_key: "ukrainian_revolution_independence_struggle", topic_readable: "Розгортання Української революції. Боротьба за відновлення незалежності", date: "22 січня 1919 р.", event: "проголошення Акта злуки УНР та ЗУНР", brief: "На Софійській площі в Києві урочисто проголошено об'єднання Української Народної Республіки та Західноукраїнської Народної Республіки в єдину соборну державу." },
    { topic_key: "ukrainian_revolution_independence_struggle", topic_readable: "Розгортання Української революції. Боротьба за відновлення незалежності", date: "грудень 1919 – травень 1920 pp.", event: "перший \"Зимовий похід\" військ УНР", brief: "Героїчний рейд армії УНР тилами денікінських та більшовицьких військ з метою збереження армії та продовження боротьби." },
    { topic_key: "ukrainian_revolution_independence_struggle", topic_readable: "Розгортання Української революції. Боротьба за відновлення незалежності", date: "квітень 1920 р.", event: "Варшавська Угода", brief: "Договір між УНР (С. Петлюра) та Польщею (Ю. Пілсудський) про спільні військові дії проти більшовиків; УНР визнавала Галичину за Польщею." },
    { topic_key: "ukrainian_revolution_independence_struggle", topic_readable: "Розгортання Української революції. Боротьба за відновлення незалежності", date: "березень 1921 р.", event: "Ризький мирний договір", brief: "Договір між Польщею, радянською Росією та радянською Україною, що завершив польсько-радянську війну та закріпив поділ українських земель." },
    { topic_key: "ukrainian_revolution_independence_struggle", topic_readable: "Розгортання Української революції. Боротьба за відновлення незалежності", date: "1921 р.", event: "утворення Української автокефальної православної церкви (УАПЦ)", brief: "На Всеукраїнському православному церковному соборі проголошено автокефалію (незалежність) української православної церкви, митрополитом обрано В. Липківського." },
    { topic_key: "ukrainian_revolution_independence_struggle", topic_readable: "Розгортання Української революції. Боротьба за відновлення незалежності", date: "листопад 1921 р.", event: "Другий \"Зимовий похід\" армії УНР", brief: "Остання спроба армії УНР (під командуванням Ю. Тютюнника) підняти загальноукраїнське повстання проти більшовицької влади, завершилася поразкою." },

    // Встановлення комуністичного тоталітарного режиму в Україні
    { topic_key: "communist_totalitarian_regime_establishment", topic_readable: "Встановлення комуністичного тоталітарного режиму в Україні", date: "1921-1923 рр.", event: "масовий голод в Україні", brief: "Перший масовий голод, спричинений політикою 'воєнного комунізму' та посухою, що забрав життя сотень тисяч людей." },
    { topic_key: "communist_totalitarian_regime_establishment", topic_readable: "Встановлення комуністичного тоталітарного режиму в Україні", date: "1922 р.", event: "входження УСРР до складу СРСР", brief: "Українська Соціалістична Радянська Республіка увійшла до складу Союзу Радянських Соціалістичних Республік як одна з республік-засновниць." },
    { topic_key: "communist_totalitarian_regime_establishment", topic_readable: "Встановлення комуністичного тоталітарного режиму в Україні", date: "1923 р.", event: "початок політики \"українізації\" / \"коренізації\" в УСРР", brief: "Політика, спрямована на залучення українців до радянського будівництва, розвиток української мови та культури в рамках комуністичної ідеології." },
    { topic_key: "communist_totalitarian_regime_establishment", topic_readable: "Встановлення комуністичного тоталітарного режиму в Україні", date: "1925 р.", event: "проголошення курсу на індустріалізацію", brief: "XIV з'їзд ВКП(б) проголосив курс на індустріалізацію країни, що передбачав прискорений розвиток важкої промисловості, часто за рахунок селянства." },

    // Утвердження більшовицького тоталітарного режиму в Україні
    { topic_key: "bolshevik_totalitarian_regime_consolidation", topic_readable: "Утвердження більшовицького тоталітарного режиму в Україні", date: "1928/1929-1932 рр.", event: "перша п'ятирічка", brief: "План розвитку народного господарства, що передбачав форсовану індустріалізацію та колективізацію сільського господарства." },
    { topic_key: "bolshevik_totalitarian_regime_consolidation", topic_readable: "Утвердження більшовицького тоталітарного режиму в Україні", date: "1928 р.", event: "судовий процес у Шахтинській справі", brief: "Сфабрикований судовий процес над інженерно-технічними працівниками Донбасу, звинуваченими у 'шкідництві', початок масових репресій проти 'старої' інтелігенції." },
    { topic_key: "bolshevik_totalitarian_regime_consolidation", topic_readable: "Утвердження більшовицького тоталітарного режиму в Україні", date: "1929 р.", event: "початок насильницької колективізації", brief: "Перехід до суцільної насильницької колективізації сільського господарства, що супроводжувався 'розкуркуленням' та репресіями проти селян." },
    { topic_key: "bolshevik_totalitarian_regime_consolidation", topic_readable: "Утвердження більшовицького тоталітарного режиму в Україні", date: "1930 р.", event: "судовий процес у справі Спілки визволення України (СВУ)", brief: "Сфабрикований судовий процес над представниками української інтелігенції, звинуваченими у створенні антирадянської організації." },
    { topic_key: "bolshevik_totalitarian_regime_consolidation", topic_readable: "Утвердження більшовицького тоталітарного режиму в Україні", date: "1932–1933 рр.", event: "Голодомор в Україні", brief: "Штучно організований радянською владою геноцид українського народу шляхом створення масового голоду, що забрав мільйони життів." },
    { topic_key: "bolshevik_totalitarian_regime_consolidation", topic_readable: "Утвердження більшовицького тоталітарного режиму в Україні", date: "1934 р.", event: "перенесення столиці УСРР з Харкова до Києва", brief: "Рішення про перенесення столиці Української Соціалістичної Радянської Республіки (з 1937 р. – УРСР) до Києва." },
    { topic_key: "bolshevik_totalitarian_regime_consolidation", topic_readable: "Утвердження більшовицького тоталітарного режиму в Україні", date: "1937 р.", event: "ухвалення Конституції УРСР", brief: "Прийняття нової ('сталінської') Конституції Української Радянської Соціалістичної Республіки, що закріплювала тоталітарний режим." },
    { topic_key: "bolshevik_totalitarian_regime_consolidation", topic_readable: "Утвердження більшовицького тоталітарного режиму в Україні", date: "1937-1938 pp.", event: "\"Великий терор\"", brief: "Період масових політичних репресій, розстрілів та депортацій, спрямованих на знищення будь-якої опозиції сталінському режиму." },

    // Західноукраїнські землі в міжвоєнний період
    { topic_key: "western_ukraine_interwar", topic_readable: "Західноукраїнські землі в міжвоєнний період", date: "1920 р.", event: "підписання Бессарабського протоколу, визнання країнами Антанти входження Бессарабії до складу Румунії", brief: "Країни Антанти визнали анексію Бессарабії Румунією, що відбулася у 1918 році." },
    { topic_key: "western_ukraine_interwar", topic_readable: "Західноукраїнські землі в міжвоєнний період", date: "1923 р.", event: "визнання країнами Антанти входження Східної Галичини до складу Польщі; саморозпуск уряду ЗУНР", brief: "Рада послів Антанти остаточно визнала Східну Галичину частиною Польщі, що призвело до саморозпуску екзильного уряду ЗУНР." },
    { topic_key: "western_ukraine_interwar", topic_readable: "Західноукраїнські землі в міжвоєнний період", date: "1925 р.", event: "утворення Українського національно демократичного об'єднання (УНДО)", brief: "Найбільша українська політична партія в Польщі, що виступала за легальні методи боротьби за права українців." },
    { topic_key: "western_ukraine_interwar", topic_readable: "Західноукраїнські землі в міжвоєнний період", date: "1929 р.", event: "утворення Організації Українських Націоналістів (ОУН)", brief: "Радикальна підпільна організація, створена у Відні, що ставила за мету здобуття незалежності України шляхом революційної боротьби (провідник Є. Коновалець)." },
    { topic_key: "western_ukraine_interwar", topic_readable: "Західноукраїнські землі в міжвоєнний період", date: "1930 р.", event: "проведення польською владою акції \"пацифікації\"", brief: "Масові репресивні заходи польської влади проти українського населення Галичини, спрямовані на придушення національно-визвольного руху." },
    { topic_key: "western_ukraine_interwar", topic_readable: "Західноукраїнські землі в міжвоєнний період", date: "1938 р.", event: "надання автономії Підкарпатській Русі у складі Чехо-Словаччини", brief: "Внаслідок Мюнхенської угоди Підкарпатська Русь (Закарпаття) отримала автономний статус у складі Чехо-Словаччини." },
    { topic_key: "western_ukraine_interwar", topic_readable: "Західноукраїнські землі в міжвоєнний період", date: "15 березня 1939 р.", event: "проголошення незалежності Карпатської України", brief: "Сойм Карпатської України проголосив незалежність держави, президентом обрано А. Волошина; незабаром окупована Угорщиною." },

    // Україна в роки Другої світової війни
    { topic_key: "ukraine_ww2", topic_readable: "Україна в роки Другої світової війни", date: "23 серпня 1939 р.", event: "радянсько-німецький пакт про ненапад (\"пакт Молотова-Ріббентропа\")", brief: "Договір між СРСР та Німеччиною, що містив таємний протокол про поділ сфер впливу в Східній Європі, включаючи українські землі." },
    { topic_key: "ukraine_ww2", topic_readable: "Україна в роки Другої світової війни", date: "1 вересня 1939 р.", event: "початок Другої світової війни", brief: "Напад Німеччини на Польщу, що ознаменував початок найкривавішої війни в історії людства." },
    { topic_key: "ukraine_ww2", topic_readable: "Україна в роки Другої світової війни", date: "17 вересня 1939 р.", event: "вторгнення Червоної армії на територію Західної України", brief: "Радянські війська перейшли польський кордон, окупувавши Західну Україну та Західну Білорусь згідно з таємним протоколом пакту Молотова-Ріббентропа." },
    { topic_key: "ukraine_ww2", topic_readable: "Україна в роки Другої світової війни", date: "червень 1940 р.", event: "вторгнення Червоної армії на територію Бессарабії та Північної Буковини", brief: "СРСР висунув ультиматум Румунії, після чого Червона армія окупувала Бессарабію та Північну Буковину, які були включені до складу УРСР та новоствореної МРСР." },
    { topic_key: "ukraine_ww2", topic_readable: "Україна в роки Другої світової війни", date: "22 червня 1941 р.", event: "напад Німеччини на СРСР", brief: "Німеччина та її союзники без оголошення війни напали на Радянський Союз, розпочавши радянсько-німецьку війну (Велику Вітчизняну війну)." },
    { topic_key: "ukraine_ww2", topic_readable: "Україна в роки Другої світової війни", date: "30 червня 1941 р.", event: "проголошення Акта відновлення Української Держави", brief: "У Львові ОУН(б) на чолі з Я. Стецьком проголосила відновлення незалежності Української держави, що не було визнано німецькою окупаційною владою." },
    { topic_key: "ukraine_ww2", topic_readable: "Україна в роки Другої світової війни", date: "14 жовтня 1942 р.", event: "створення Української повстанської армії (УПА)", brief: "Символічна дата створення УПА, військово-політичного формування, що вело боротьбу за незалежність України проти німецьких та радянських окупантів." },
    { topic_key: "ukraine_ww2", topic_readable: "Україна в роки Другої світової війни", date: "грудень 1942 р.", event: "початок вигнання нацистських загарбників з України", brief: "Після Сталінградської битви розпочалося звільнення окупованих територій СРСР, включаючи українські землі." },
    { topic_key: "ukraine_ww2", topic_readable: "Україна в роки Другої світової війни", date: "6 листопада 1943 р.", event: "визволення Києва від нацистських окупантів", brief: "Радянські війська звільнили столицю України місто Київ внаслідок запеклих боїв та форсування Дніпра." },
    { topic_key: "ukraine_ww2", topic_readable: "Україна в роки Другої світової війни", date: "січень – лютий 1944 р.", event: "Корсунь-Шевченківська наступальна операція", brief: "Велика наступальна операція радянських військ, що призвела до оточення та розгрому значного німецького угруповання ('Сталінград на Дніпрі')." },
    { topic_key: "ukraine_ww2", topic_readable: "Україна в роки Другої світової війни", date: "28 жовтня 1944 р.", event: "завершення вигнання німецьких військ та їх союзників з території України", brief: "Офіційна дата повного звільнення території сучасної України від нацистських окупантів." },
    { topic_key: "ukraine_ww2", topic_readable: "Україна в роки Другої світової війни", date: "8 травня 1945 р.", event: "День Перемоги над нацизмом в Другій світовій війні", brief: "Капітуляція нацистської Німеччини; в Україні відзначається як День пам'яті та примирення і День перемоги над нацизмом у Другій світовій війні." },
    { topic_key: "ukraine_ww2", topic_readable: "Україна в роки Другої світової війни", date: "2 вересня 1945 р.", event: "завершення Другої світової війни", brief: "Капітуляція Японії, що ознаменувала остаточне завершення Другої світової війни." },

    // Україна в перші повоєнні роки
    { topic_key: "ukraine_post_ww2", topic_readable: "Україна в перші повоєнні роки", date: "1945 р.", event: "входження Закарпаття до складу УРСР", brief: "Закарпатська Україна (колишня Підкарпатська Русь) була включена до складу Української РСР на основі договору між СРСР та Чехословаччиною." },
    { topic_key: "ukraine_post_ww2", topic_readable: "Україна в перші повоєнні роки", date: "квітень 1945 р.", event: "Україна стає співзасновницею ООН", brief: "Українська РСР стала однією з країн-засновниць Організації Об'єднаних Націй, маючи окреме представництво." },
    { topic_key: "ukraine_post_ww2", topic_readable: "Україна в перші повоєнні роки", date: "березень 1946 р.", event: "ліквідація УГКЦ", brief: "На Львівському 'псевдособорі', інспірованому радянською владою, було оголошено про ліквідацію Української Греко-Католицької Церкви та її 'возз'єднання' з РПЦ." },
    { topic_key: "ukraine_post_ww2", topic_readable: "Україна в перші повоєнні роки", date: "1946-1947 pp.", event: "голод в Україні", brief: "Масовий голод, спричинений посухою та надмірними хлібозаготівлями, що призвів до загибелі сотень тисяч людей." },
    { topic_key: "ukraine_post_ww2", topic_readable: "Україна в перші повоєнні роки", date: "квітень липень 1947 р.", event: "проведення польською владою операції «Вісла»", brief: "Примусова депортація українського населення з етнічних земель (Лемківщина, Надсяння, Холмщина, Підляшшя) на західні та північні території Польщі." },
    { topic_key: "ukraine_post_ww2", topic_readable: "Україна в перші повоєнні роки", date: "жовтень 1947 р.", event: "проведення операції \"Захід\"", brief: "Масова депортація населення Західної України (переважно членів родин учасників ОУН-УПА та 'куркулів') до Сибіру та Казахстану." },
    { topic_key: "ukraine_post_ww2", topic_readable: "Україна в перші повоєнні роки", date: "1951 р.", event: "встановлення західного кордону УРСР", brief: "Остаточне встановлення західного кордону УРСР з Польщею шляхом обміну територіями (УРСР отримала район Устрик Долішніх, Польща – район Сокаля)." },

    // Україна в умовах десталінізації
    { topic_key: "ukraine_destalinization", topic_readable: "Україна в умовах десталінізації", date: "1953-1954 pp.", event: "повстання політичних в'язнів в сталінських концтаборах. Ліквідація ГУТАБу", brief: "Низка великих повстань (Норильське, Воркутинське, Кенгірське) у таборах ГУЛАГу; розпочався процес ліквідації системи ГУЛАГ." },
    { topic_key: "ukraine_destalinization", topic_readable: "Україна в умовах десталінізації", date: "лютий 1954 р.", event: "входження Кримської області до складу УРСР", brief: "За рішенням Президії Верховної Ради СРСР Кримська область була передана зі складу РРФСР до складу Української РСР." },
    { topic_key: "ukraine_destalinization", topic_readable: "Україна в умовах десталінізації", date: "1956 р.", event: "XX з'їзд КПРС; засудження культу особи", brief: "На закритому засіданні з'їзду М. Хрущов виступив із доповіддю 'Про культ особи та його наслідки', засудивши злочини сталінського режиму; початок 'відлиги'." },
    { topic_key: "ukraine_destalinization", topic_readable: "Україна в умовах десталінізації", date: "1959 р.", event: "утворення Української робітничо-селянської спілки", brief: "Підпільна організація на чолі з Л. Лук'яненком, що ставила за мету мирний вихід України зі складу СРСР; була викрита, члени засуджені." },
    { topic_key: "ukraine_destalinization", topic_readable: "Україна в умовах десталінізації", date: "1959 р.", event: "утворення Клубу творчої молоді \"Сучасник\" у м. Київ", brief: "Один із перших осередків шістдесятників, неформальне об'єднання молодої інтелігенції, що сприяло національно-культурному відродженню." },

    // Україна у період загострення кризи радянської системи
    { topic_key: "ukraine_soviet_crisis", topic_readable: "Україна у період загострення кризи радянської системи", date: "1965 р.", event: "перша хвиля масових затримань діячів антирежимного руху", brief: "Арешти представників української інтелігенції (шістдесятників), звинувачених в 'антирадянській агітації та пропаганді'." },
    { topic_key: "ukraine_soviet_crisis", topic_readable: "Україна у період загострення кризи радянської системи", date: "1970 – 1972 pp.", event: "видання самвидавного \"Українського вісника\"", brief: "Підпільний журнал, редагований В. Чорноволом, що інформував про порушення прав людини в Україні, репресії та національно-культурне життя." },
    { topic_key: "ukraine_soviet_crisis", topic_readable: "Україна у період загострення кризи радянської системи", date: "1972 р.", event: "друга хвиля масових затримань діячів антирежимного руху", brief: "Нова хвиля репресій проти української інтелігенції, пов'язана зі зміною керівництва УРСР (П. Шелеста на В. Щербицького)." },
    { topic_key: "ukraine_soviet_crisis", topic_readable: "Україна у період загострення кризи радянської системи", date: "1976 р.", event: "утворення Української Гельсінської групи", brief: "Правозахисна організація (Українська громадська група сприяння виконанню Гельсінських угод) на чолі з М. Руденком, що фіксувала порушення прав людини в Україні." },

    // Відновлення незалежності України
    { topic_key: "ukraine_independence_restoration", topic_readable: "Відновлення незалежності України", date: "квітень 1985 р.", event: "початок «перебудови»", brief: "Курс реформ, проголошений М. Горбачовим, що передбачав 'прискорення' соціально-економічного розвитку, 'гласність' та демократизацію." },
    { topic_key: "ukraine_independence_restoration", topic_readable: "Відновлення незалежності України", date: "26 квітня 1986 р.", event: "катастрофа на Чорнобильській АЕС", brief: "Найбільша техногенна катастрофа в історії людства, що мала трагічні наслідки для України та світу, сприяла пробудженню громадської активності." },
    { topic_key: "ukraine_independence_restoration", topic_readable: "Відновлення незалежності України", date: "вересень 1989 р.", event: "створення Народного руху України за перебудову", brief: "Масова громадсько-політична організація, що об'єднала демократичні сили і відіграла ключову роль у здобутті незалежності України." },
    { topic_key: "ukraine_independence_restoration", topic_readable: "Відновлення незалежності України", date: "березень 1990 р.", event: "перші альтернативні вибори до Верховної Ради УРСР", brief: "Вибори, на яких вперше на альтернативній основі було обрано депутатів до Верховної Ради УРСР, що сформувало парламентську опозицію ('Народна Рада')." },
    { topic_key: "ukraine_independence_restoration", topic_readable: "Відновлення незалежності України", date: "16 липня 1990 р.", event: "прийняття Верховною Радою УРСР Декларації про державний суверенітет України", brief: "Документ, що проголосив верховенство, самостійність, повноту і неподільність влади республіки в межах її території та незалежність і рівноправність у зовнішніх зносинах." },
    { topic_key: "ukraine_independence_restoration", topic_readable: "Відновлення незалежності України", date: "жовтень 1990 р.", event: "\"Революція на граніті\"", brief: "Студентське голодування на Майдані Незалежності в Києві з вимогами недопущення підписання нового союзного договору та відставки уряду." },
    { topic_key: "ukraine_independence_restoration", topic_readable: "Відновлення незалежності України", date: "24 серпня 1991 р.", event: "прийняття Верховною Радою УРСР Акта проголошення незалежності України", brief: "Історичний документ, що проголосив створення самостійної української держави — України." },
    { topic_key: "ukraine_independence_restoration", topic_readable: "Відновлення незалежності України", date: "1 грудня 1991 р.", event: "проведення Всеукраїнського референдуму та обрання Президента України", brief: "На референдумі понад 90% громадян підтвердили Акт проголошення незалежності України; першим Президентом України обрано Л. Кравчука." },

    // Становлення України як незалежної держави
    { topic_key: "ukraine_independent_state_formation", topic_readable: "Становлення України як незалежної держави", date: "6 грудня 1991 р.", event: "заснування Збройних сил України", brief: "Верховна Рада ухвалила закони 'Про оборону України' та 'Про Збройні Сили України', що започаткували створення національної армії." },
    { topic_key: "ukraine_independent_state_formation", topic_readable: "Становлення України як незалежної держави", date: "липень 1994 р.", event: "обрання Л. Кучми Президентом України", brief: "Леонід Кучма переміг на дострокових президентських виборах, ставши другим Президентом незалежної України." },
    { topic_key: "ukraine_independent_state_formation", topic_readable: "Становлення України як незалежної держави", date: "1995 р.", event: "обрання України членом Ради Європи (РЄ)", brief: "Україна стала членом Ради Європи, взявши на себе зобов'язання дотримуватися європейських стандартів у галузі прав людини та демократії." },
    { topic_key: "ukraine_independent_state_formation", topic_readable: "Становлення України як незалежної держави", date: "28 червня 1996 р.", event: "ухвалення Конституції України", brief: "Верховна Рада ухвалила Основний Закон – Конституцію України, що закріпила основи суспільного і державного ладу, права та свободи громадян." },
    { topic_key: "ukraine_independent_state_formation", topic_readable: "Становлення України як незалежної держави", date: "вересень 1996 р.", event: "запровадження національної грошової одиниці – гривні", brief: "Проведено грошову реформу, в результаті якої було запроваджено національну валюту України – гривню." },
    { topic_key: "ukraine_independent_state_formation", topic_readable: "Становлення України як незалежної держави", date: "жовтень – грудень 2004 р.", event: "\"Помаранчева революція\", обрання Президентом України В. Ющенка", brief: "Масові протести проти фальсифікації результатів президентських виборів, що призвели до повторного голосування та перемоги Віктора Ющенка." },

    // Творення нової України
    { topic_key: "modern_ukraine_formation", topic_readable: "Творення нової України", date: "2008 р.", event: "вступ України до Світової організації торгівлі (СОТ)", brief: "Україна стала повноправним членом СОТ, що відкрило нові можливості для міжнародної торгівлі та економічної інтеграції." },
    { topic_key: "modern_ukraine_formation", topic_readable: "Творення нової України", date: "січень 2010 р.", event: "обрання В. Януковича Президентом України", brief: "Віктор Янукович переміг на президентських виборах, ставши четвертим Президентом України." },
    { topic_key: "modern_ukraine_formation", topic_readable: "Творення нової України", date: "листопад 2013 – лютий 2014 рр.", event: "\"Революція гідності\"; повалення режиму В. Януковича", brief: "Масові протести проти відмови від євроінтеграції та узурпації влади, що призвели до втечі В. Януковича та зміни влади в країні." },
    { topic_key: "modern_ukraine_formation", topic_readable: "Творення нової України", date: "червень 2014 р.", event: "обрання П. Порошенка Президентом України", brief: "Петро Порошенко переміг на позачергових президентських виборах в умовах російської агресії." },
    { topic_key: "modern_ukraine_formation", topic_readable: "Творення нової України", date: "2014 р.", event: "підписання Україною Угоди про асоціацію з Європейським Союзом (ЄС)", brief: "Україна підписала політичну та економічну частини Угоди про асоціацію з ЄС, що визначило її євроінтеграційний курс." },
    { topic_key: "modern_ukraine_formation", topic_readable: "Творення нової України", date: "вересень 2014 р., лютий 2015 р.", event: "Мінські домовленості", brief: "Угоди, досягнуті в Мінську з метою врегулювання збройного конфлікту на сході України, що включали припинення вогню та політичне врегулювання." }
];

// console.log(ALL_HISTORICAL_EVENTS.length); // Should be 177
        
        // --- Initialization ---
        // window.onload будет заменен на DOMContentLoaded для более раннего доступа к элементам.

    </script>
</body>
</html>
